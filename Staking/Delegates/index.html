
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="https://cardano-community.github.io/guild-operators/Staking/Delegates/" rel="canonical"/>
<link href="../../overrides/guildicon.png" rel="icon"/>
<meta content="mkdocs-1.2.1, mkdocs-material-7.1.9" name="generator"/>
<title>Delegates - Guild Operators</title>
<link href="../../assets/stylesheets/main.ca7ac06f.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.f1a3b89f.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
<link href="../../overrides/custom.css" rel="stylesheet"/>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-MLM58HW7RF"),document.addEventListener("DOMContentLoaded",function(){"undefined"!=typeof location$&&location$.subscribe(function(t){gtag("config","G-MLM58HW7RF",{page_path:t.pathname})})})</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-MLM58HW7RF"></script>
</head>
<body data-md-color-accent="green" data-md-color-primary="green" data-md-color-scheme="slate" dir="ltr">
<script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
<script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#create-delegates-staking-keys-and-addresses">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Guild Operators" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Guild Operators">
<img alt="logo" src="../../overrides/guildicon.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Guild Operators
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Delegates
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="green" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="green" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31z"></path></svg>
</label>
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="green" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="green" data-md-color-scheme="default" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22z"></path></svg>
</label>
</form>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" data-md-state="active" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</label>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/cardano-community/guild-operators/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    cardano-community/guild-operators
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Guild Operators" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Guild Operators">
<img alt="logo" src="../../overrides/guildicon.png"/>
</a>
    Guild Operators
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/cardano-community/guild-operators/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    cardano-community/guild-operators
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../index.md">
        Home
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../basics/">
        Basics
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3">
        Build and Run
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Build and Run" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          Build and Run
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../build/">
        Overview
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Build/node-cli/">
        Node &amp; CLI
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Build/dbsync/">
        DBSync
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Build/pgrest/">
        PostgREST
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Build/offchain-metadata-tools/">
        Offchain Metadata Tools
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4">
        Scripts
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Scripts" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          Scripts
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../Scripts/env/">
        Common env
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" id="__nav_4_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2">
        CNTools
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="CNTools" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_2">
<span class="md-nav__icon md-icon"></span>
          CNTools
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../Scripts/cntools/">
        Overview
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Scripts/cntools-common/">
        Common Tasks
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Scripts/cntools-changelog/">
        Changelog
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Scripts/logmonitor/">
        Log Monitor
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Scripts/cncli/">
        CNCLI
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Scripts/gliveview/">
        Guild LiveView
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Scripts/topologyupdater/">
        Topology Updater
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Scripts/itnwitness/">
        ITN Metadata Proof
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Scripts/itnrewards/">
        ITN Rewards
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5">
        Docker
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Docker" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
          Docker
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../docker/docker/">
        Overview
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../docker/build/">
        Build
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../docker/run/">
        Run
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../docker/tips/">
        Tips
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6">
        Appendix
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Appendix" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
          Appendix
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../Appendix/postgres/">
        Sample Postgres Setup
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../pgrest-meetings/25Jun2021.md">
        PGRest meetings 1
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../pgrest-meetings/02Jul2021.md">
        PGRest meetings 2
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../contributors/">
        Contributors
      </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#create-delegates-staking-keys-and-addresses">
    Create delegate's staking keys and addresses
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#generating-the-staking-key-certificate">
    Generating the Staking key certificate
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#registering-the-delegates-staking-key-on-chain">
    Registering the delegate's staking key on chain
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#create-a-delegation-certificate-and-submit-to-the-network">
    Create a delegation certificate and submit to the network
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/cardano-community/guild-operators/edit/master/docs/Staking/Delegates.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"></path></svg>
</a>
<h1>Delegates</h1>
<p>The delegates are the stake holders who have some funds deposited and want to participate in staking.
Therefore the steps for delegating stakes are the following:</p>
<ul>
<li>Create <code>stake key(s)</code> for generating the <strong>delegate</strong>'s <code>reward address(es)</code> for collecting their <code>stake rewards</code>.</li>
<li>Create <code>payment key(s)</code> for generating the <strong>delegate</strong>'s <code>payment address(es)</code> for payments that will participate in stake delegation and also deposititing some funds.</li>
<li>Register <code>stake address</code> on the blockhain, <strong>with</strong> key deposit, which is required for participation in staking, and</li>
<li>Create and submit the <strong>stake delegation certificate</strong> for the selected pool.</li>
</ul>
<h4 id="create-delegates-staking-keys-and-addresses">Create <em>delegate's</em> staking keys and addresses<a class="headerlink" href="#create-delegates-staking-keys-and-addresses" title="Permanent link">⚓︎</a></h4>
<p>A <strong>stake address</strong>, derived from a <code>stake verification key</code>, is a simple <code>reward (account) address</code> which is not a <code>payment address</code> therefore it cannot be used as an output of a transaction.
In the <code>cardano-cli</code> they use a CBOR format for preventing it to be added as the input into a transaction.</p>
<blockquote>
<p>Keep in mind, that only the <strong>reward</strong> addresses and the <strong>base_</strong>, <strong>pointer</strong> and some <strong>script</strong> (not available yet) addresses can participate in the staking.</p>
</blockquote>
<p>First, we need to create the relevant <code>payment</code> and <code>stake</code> keys and the related addresses for the delegate. The payment address will be used for paying the transactions for sending the <code>registration certificate</code> (which is just simply the reward account address in some CBOR encoded format) to the chain.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Delegate's staking/acount key, then Staking/Account address</span>
<span class="c1">############################################################</span>
mkdir delegate <span class="o">&amp;&amp;</span> <span class="nb">pushd</span> delegate

<span class="c1"># Generate the stake address key-pair</span>
cardano-cli shelley stake-address key-gen <span class="se">\</span>
--verification-key-file stake.vkey <span class="se">\</span>
--signing-key-file stake.skey

<span class="c1"># Generate the actual stake address with the stake key-pair</span>
cardano-cli shelley stake-address build <span class="se">\</span>
--stake-verification-key-file stake.vkey <span class="se">\</span>
--out-file stake.addr <span class="se">\</span>
--mainnet

cat stake.addr
<span class="c1"># stake1u9a3t4rgddm4expj0ucyxhxg3ft9ugk2ry6r9w69h04ea6cfj887f</span>

<span class="c1"># Generate the payment address key-pair</span>
cardano-cli shelley address key-gen <span class="se">\</span>
--verification-key-file payment.vkey <span class="se">\</span>
--signing-key-file payment.skey
</code></pre></div>
<blockquote>
<p><strong>NOTE</strong>: The following command use <code>--mainnet</code>. For testnet usage, use <code>--testnet-magic 1097911063</code> instead!</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="c1"># Generate the Shelley address with both payment and stake keys</span>

cardano-cli shelley address build <span class="se">\</span>
--payment-verification-key-file payment.vkey <span class="se">\</span>
--stake-verification-key-file stake.vkey <span class="se">\</span>
--out-file payment.addr <span class="se">\</span>
--mainnet <span class="c1"># for testnet use, replace this with `--testnet-magic 1097911063`</span>

cat payment.addr

<span class="c1"># addr1q8mhchxehfs42erc33wdxrwvjalpc262tw4lus8dz30ts5tmzh2xs6mhtjvrylesgdwv3zjktc3v5xf5x2a5twltnm4s28w6nf</span>

<span class="c1"># Query the newly created address (need to export CARDANO_NODE_SOCKET_PATH first)</span>

<span class="nb">export</span> <span class="nv">CARDANO_NODE_SOCKET_PATH</span><span class="o">=</span>path/to/your/node.socket <span class="o">(</span>e.g. <span class="nv">$CNODE_HOME</span>/sockets/node0.socket<span class="o">)</span>
cardano-cli shelley query utxo <span class="se">\</span>
--address <span class="k">$(</span>cat payment.addr<span class="k">)</span> <span class="se">\</span>
--mainnet

<span class="c1"># TxHash TxIx Lovelace</span>

<span class="c1">#----------------------------------------------------------------------------------------</span>
</code></pre></div>
<p>Now that we have our stake and Shelley addresses, we need to register our stake address on the blockchain.</p>
<blockquote>
<p><strong>NOTE</strong>: to continue, you will need to have some ADA funds on the address to cover transaction costs!</p>
</blockquote>
<h4 id="generating-the-staking-key-certificate">Generating the Staking key certificate<a class="headerlink" href="#generating-the-staking-key-certificate" title="Permanent link">⚓︎</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># First we need to generate the stake address registration</span>
<span class="c1"># certificate using the stake verification key</span>
<span class="c1">############################################################</span>
cardano-cli shelley stake-address registration-certificate <span class="se">\</span>
    --stake-verification-key-file stake.vkey <span class="se">\</span>
    --out-file stake.cert

cat stake.cert
<span class="c1"># {</span>
<span class="c1">#     "type": "CertificateShelley",</span>
<span class="c1">#     "description": "Stake Address Registration Certificate",</span>
<span class="c1">#     "cborHex": "82008200581c7b15d4686b775c98327f30435cc88a565e22ca193432bb45bbeb9eeb"</span>
<span class="c1"># }</span>
</code></pre></div>
<h4 id="registering-the-delegates-staking-key-on-chain">Registering the delegate's staking key on chain<a class="headerlink" href="#registering-the-delegates-staking-key-on-chain" title="Permanent link">⚓︎</a></h4>
<p>The delegate's staking key needs to be registered in the blockchain. To register it we need to make a simple transaction including our <code>stake.cert</code> using any payment address.</p>
<p>Keep in mind that any stake key registration certificate needs a deposit for the costs of tracking the key and the corresponding reward account. Also, it does not require any witness to register the certificate, but only the witness for the fees from the input of the transaction.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Get param files</span>
<span class="nb">export</span> <span class="nv">CARDANO_NODE_SOCKET_PATH</span><span class="o">=</span><span class="nv">$CNODE_HOME</span>/sockets/node0.socket
cardano-cli shelley query protocol-parameters <span class="se">\</span>
--mainnet <span class="se">\</span>
--out-file params.json

<span class="c1"># CALCULATE TRANSACTION FEES + REGISTRATION KEY DEPOSIT</span>
<span class="c1"># You need only one signing key included in fee calculation:</span>
<span class="c1"># the `payment` address signing key of the input</span>
<span class="c1"># as the stake key reg cert does not need a witness</span>

<span class="c1"># Setup variables for building transactions:</span>
<span class="nv">FROM</span><span class="o">=</span><span class="k">$(</span> cat payment.addr <span class="k">)</span> <span class="c1"># the address we will pay the fees from</span>
<span class="nv">TX</span><span class="o">=</span><span class="k">$(</span>cardano-cli shelley query utxo --mainnet --address <span class="s2">"</span><span class="nv">$FROM</span><span class="s2">"</span>  <span class="p">|</span> grep <span class="s2">"^[^- ]"</span> <span class="p">|</span> sort -k 2n <span class="p">|</span> tail -1<span class="k">)</span>
<span class="nv">UTXO</span><span class="o">=</span><span class="k">$(</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$TX</span><span class="s2">"</span> <span class="p">|</span> awk <span class="s1">'{ print $1 }'</span><span class="k">)</span>
<span class="nv">ID</span><span class="o">=</span><span class="k">$(</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$TX</span><span class="s2">"</span> <span class="p">|</span> awk <span class="s1">'{ print $2 }'</span><span class="k">)</span>
<span class="nv">BALANCE</span><span class="o">=</span><span class="k">$(</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$TX</span><span class="s2">"</span> <span class="p">|</span> awk <span class="s1">'{ print $3 }'</span><span class="k">)</span>
<span class="nv">INPUT</span><span class="o">=</span><span class="s2">"</span><span class="si">${</span><span class="nv">UTXO</span><span class="si">}</span><span class="s2">#</span><span class="si">${</span><span class="nv">ID</span><span class="si">}</span><span class="s2">"</span>

<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$INPUT</span><span class="s2">"</span>
<span class="c1"># 55be4bb91c6469ba419b102e703a5f20d1c022351e64cf75033f7d83c6aebbdc#0</span>

<span class="c1"># First, we need to build a draft transaction in order to calculate minimum fees</span>
cardano-cli shelley transaction build-raw <span class="se">\</span>
--tx-in <span class="s2">"</span><span class="nv">$INPUT</span><span class="s2">"</span> <span class="se">\</span>
--tx-out <span class="k">$(</span>cat payment.addr<span class="k">)</span>+0 <span class="se">\</span>
--ttl <span class="m">0</span> <span class="se">\</span>
--fee <span class="m">0</span> <span class="se">\</span>
--out-file tx.raw <span class="se">\</span>
--certificate-file stake.cert


<span class="nv">FEE</span><span class="o">=</span><span class="k">$(</span>cardano-cli shelley transaction calculate-min-fee <span class="se">\</span>
--tx-body-file tx.raw <span class="se">\</span>
--tx-in-count <span class="m">1</span> <span class="se">\</span>
--tx-out-count <span class="m">1</span> <span class="se">\</span>
--witness-count <span class="m">1</span> <span class="se">\</span>
--byron-witness-count <span class="m">0</span> <span class="se">\</span>
--mainnet <span class="se">\</span>
--protocol-params-file params.json <span class="se">\</span>
<span class="p">|</span> awk <span class="s1">'{ print $1}'</span><span class="k">)</span>

<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$FEE</span><span class="s2">"</span>

<span class="c1"># 172453 - transaction fee in Lovelace</span>

<span class="c1"># Now, we need to get the registration fee - the "keyDeposit" specified in the protocol params.json</span>
<span class="c1"># This is the amount we can get back when we de-register the stake key</span>

cat params.json <span class="p">|</span> grep keyDeposit

<span class="c1"># "keyDeposit": 2000000</span>

<span class="nv">KEYDEP</span><span class="o">=</span><span class="m">2000000</span>

<span class="c1"># Now we have everything needed to calculate the change:</span>

<span class="nv">CHANGE</span><span class="o">=</span><span class="k">$((</span> <span class="nv">$BALANCE</span> <span class="o">-</span> <span class="nv">$FEE</span> <span class="o">-</span> <span class="nv">$KEYDEP</span> <span class="k">))</span>

<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$CHANGE</span><span class="s2">"</span>

<span class="c1"># 2827547 &lt;- 5000000 - 172453 - 2000000</span>

<span class="nv">OUTPUT</span><span class="o">=</span><span class="s2">"</span><span class="si">${</span><span class="nv">FROM</span><span class="si">}</span><span class="s2">+</span><span class="si">${</span><span class="nv">CHANGE</span><span class="si">}</span><span class="s2">"</span>

<span class="c1"># You can run the following to confirm all the variables are right</span>
<span class="nb">echo</span> <span class="s2">"Balance: </span><span class="nv">$BALANCE</span><span class="s2">, Change: </span><span class="nv">$CHANGE</span><span class="s2">, runTxCalculateMinFee: </span><span class="nv">$FEE</span><span class="s2">"</span>
<span class="c1"># Balance: 5000000, Change: 2827547, runTxCalculateMinFee: 172453</span>
<span class="nb">echo</span> <span class="s2">"Input: </span><span class="nv">$INPUT</span><span class="s2">"</span>
<span class="c1"># Input: 55be4bb91c6469ba419b102e703a5f20d1c022351e64cf75033f7d83c6aebbdc#0</span>
<span class="nb">echo</span> <span class="s2">"Output: </span><span class="nv">$OUTPUT</span><span class="s2">"</span>
<span class="c1"># Output: addr1q8mhchxehfs42erc33wdxrwvjalpc262tw4lus8dz30ts5tmzh2xs6mhtjvrylesgdwv3zjktc3v5xf5x2a5twltnm4s28w6nf+2827547</span>


<span class="c1"># Now, we need to determine the --ttl (time to Live) for the transaction. We query the blockchain tip and look for the 'slotNo':</span>
cardano-cli shelley query tip --mainnet
<span class="c1"># {</span>
<span class="c1">#     "blockNo": 4711506,</span>
<span class="c1">#     "headerHash": "1e95d9ebe29db6db8f8ae5ccf15351f41eddc8505716310c7471ff31b025878b",</span>
<span class="c1">#     "slotNo": 8967182 &lt;- this is the tip we are looking for</span>
<span class="c1"># }</span>

<span class="c1"># Set TTL to be current tip + 500 (that gives us 500 seconds, ~ 8 minutes to complete the transaction)</span>
<span class="nv">TTL</span><span class="o">=</span><span class="k">$((</span><span class="m">8967182</span><span class="o">+</span><span class="m">500</span><span class="k">))</span> <span class="c1"># **replace this accordingly with the current tip**</span>

<span class="c1"># Finally, build the transaction</span>
cardano-cli shelley transaction build-raw <span class="se">\</span>
    --tx-in <span class="s2">"</span><span class="nv">$INPUT</span><span class="s2">"</span> <span class="se">\</span>
    --tx-out <span class="s2">"</span><span class="si">${</span><span class="nv">FROM</span><span class="si">}</span><span class="s2">+</span><span class="si">${</span><span class="nv">CHANGE</span><span class="si">}</span><span class="s2">"</span> <span class="se">\</span>
    --ttl <span class="s2">"</span><span class="nv">$TTL</span><span class="s2">"</span> <span class="se">\</span>
    --fee <span class="s2">"</span><span class="nv">$FEE</span><span class="s2">"</span> <span class="se">\</span>
    --out-file tx.raw <span class="se">\</span>
    --certificate-file stake.cert
<span class="c1"># Sign it</span>
cardano-cli shelley transaction sign <span class="se">\</span>
    --tx-body-file tx.raw <span class="se">\</span>
    --signing-key-file payment.skey <span class="se">\</span>
    --signing-key-file stake.skey <span class="se">\</span>
    --mainnet <span class="se">\</span>
    --out-file tx.signed
<span class="c1"># And submit it</span>
cardano-cli shelley transaction submit <span class="se">\</span>
    --tx-file tx.signed <span class="se">\</span>
    --mainnet

<span class="c1"># Your stake key will now be registered on the blockchain once the transaction goes through.</span>
<span class="c1"># Now, we are ready to delegate.</span>
</code></pre></div>
<h4 id="create-a-delegation-certificate-and-submit-to-the-network">Create a delegation certificate and submit to the network<a class="headerlink" href="#create-a-delegation-certificate-and-submit-to-the-network" title="Permanent link">⚓︎</a></h4>
<p>To delegate to a pool, we need to create a delegation certificate using our <code>stake.vkey</code> and the stake pool's details. We will then submit this certificate to the network in a transaction much like we registered our staking address.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># You will need either a stake pool's cold.vkey or a stake pool's ID</span>
<span class="nv">POOL_ID</span><span class="o">=</span>5271fc86fd9c25613c138c4aef6f8593b2952c95897b079facebbc9e

<span class="c1"># !! BE AWARE!! that the `stake.key` must be already registered on the chain at this point.</span>
cardano-cli shelley stake-address delegation-certificate <span class="se">\</span>
    --stake-verification-key-file stake.vkey <span class="se">\</span>
    --stake-pool-id <span class="s2">"</span><span class="nv">$POOL_ID</span><span class="s2">"</span> <span class="se">\</span>
    --out-file delegation.cert

<span class="c1">####################################################################</span>
<span class="c1">####################################################################</span>

<span class="c1"># Calculate the minimum fee. Again, we build a draft transaction, but we need to update our variables beforehand.</span>
<span class="nv">TX</span><span class="o">=</span><span class="k">$(</span>cardano-cli shelley query utxo --mainnet --address <span class="s2">"</span><span class="nv">$FROM</span><span class="s2">"</span>  <span class="p">|</span> grep <span class="s2">"^[^- ]"</span> <span class="p">|</span> sort -k 2n <span class="p">|</span> tail -1<span class="k">)</span>
<span class="nv">UTXO</span><span class="o">=</span><span class="k">$(</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$TX</span><span class="s2">"</span> <span class="p">|</span> awk <span class="s1">'{ print $1 }'</span><span class="k">)</span>
<span class="nv">ID</span><span class="o">=</span><span class="k">$(</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$TX</span><span class="s2">"</span> <span class="p">|</span> awk <span class="s1">'{ print $2 }'</span><span class="k">)</span>
<span class="nv">BALANCE</span><span class="o">=</span><span class="k">$(</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$TX</span><span class="s2">"</span> <span class="p">|</span> awk <span class="s1">'{ print $3 }'</span><span class="k">)</span>
<span class="nv">INPUT</span><span class="o">=</span><span class="s2">"</span><span class="si">${</span><span class="nv">UTXO</span><span class="si">}</span><span class="s2">#</span><span class="si">${</span><span class="nv">ID</span><span class="si">}</span><span class="s2">"</span>

<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$INPUT</span><span class="s2">"</span>
<span class="c1"># 21190c4dd72173e5b78c0c766379e97339fa2f5fa96a47fc1c2db45605fb7e5e#0</span>

cardano-cli shelley transaction build-raw <span class="se">\</span>
--tx-in <span class="s2">"</span><span class="nv">$INPUT</span><span class="s2">"</span> <span class="se">\</span>
--tx-out <span class="k">$(</span>cat payment.addr<span class="k">)</span>+0 <span class="se">\</span>
--ttl <span class="m">0</span> <span class="se">\</span>
--fee <span class="m">0</span> <span class="se">\</span>
--out-file tx.raw <span class="se">\</span>
--certificate-file delegation.cert


<span class="nv">FEE</span><span class="o">=</span><span class="k">$(</span>cardano-cli shelley transaction calculate-min-fee <span class="se">\</span>
--tx-body-file tx.raw <span class="se">\</span>
--tx-in-count <span class="m">1</span> <span class="se">\</span>
--tx-out-count <span class="m">1</span> <span class="se">\</span>
--witness-count <span class="m">1</span> <span class="se">\</span>
--byron-witness-count <span class="m">0</span> <span class="se">\</span>
--mainnet <span class="se">\</span>
--protocol-params-file params.json <span class="se">\</span>
<span class="p">|</span> awk <span class="s1">'{ print $1}'</span><span class="k">)</span>

<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$FEE</span><span class="s2">"</span>

<span class="c1"># 172453 - transaction fee in Lovelace</span>

<span class="nv">CHANGE</span><span class="o">=</span><span class="k">$((</span> <span class="nv">$BALANCE</span> <span class="o">-</span> <span class="nv">$FEE</span><span class="k">))</span>
<span class="nv">OUTPUT</span><span class="o">=</span><span class="s2">"</span><span class="si">${</span><span class="nv">FROM</span><span class="si">}</span><span class="s2">+</span><span class="si">${</span><span class="nv">CHANGE</span><span class="si">}</span><span class="s2">"</span>

<span class="c1"># Determine TTL:</span>
cardano-cli shelley query tip --mainnet
<span class="c1"># {</span>
<span class="c1">#     "blockNo": 4711631,</span>
<span class="c1">#     "headerHash": "253570b12db0f6810d2a9f62ef79f7d5101a8f5de3743b26a0257b0e2c0290a7",</span>
<span class="c1">#     "slotNo": 8969917</span>
<span class="c1"># }</span>


<span class="c1"># Set TTL to be current tip + 500 (that gives us 500 seconds, ~ 8 minutes to complete the transaction)</span>
<span class="nv">TTL</span><span class="o">=</span><span class="k">$((</span><span class="m">8969917</span><span class="o">+</span><span class="m">500</span><span class="k">))</span> <span class="c1"># **replace this accordingly with the current tip**</span>

<span class="c1"># Build the transaction</span>
cardano-cli shelley transaction build-raw <span class="se">\</span>
     --tx-in <span class="s2">"</span><span class="nv">$INPUT</span><span class="s2">"</span> <span class="se">\</span>
     --tx-out <span class="s2">"</span><span class="nv">$OUTPUT</span><span class="s2">"</span> <span class="se">\</span>
     --ttl <span class="s2">"</span><span class="nv">$TTL</span><span class="s2">"</span> <span class="se">\</span>
     --fee <span class="s2">"</span><span class="nv">$FEE</span><span class="s2">"</span> <span class="se">\</span>
     --out-file delegation.raw <span class="se">\</span>
     --certificate-file delegation.cert

<span class="c1"># Sign</span>
<span class="c1"># You need 2 signing keys</span>
<span class="c1"># 1. the `payment.skey` for wittness the input and</span>
<span class="c1"># 2. the `stake.skey` for signing the delegation certificate.</span>
cardano-cli shelley transaction sign <span class="se">\</span>
    --tx-body-file delegation.raw <span class="se">\</span>
    --signing-key-file stake.skey <span class="se">\</span>
    --signing-key-file payment.skey <span class="se">\</span>
    --mainnet <span class="se">\</span>
    --out-file delegation.signed

<span class="c1"># Before</span>

<span class="c1"># Submit:</span>
cardano-cli shelley transaction submit <span class="se">\</span>
    --tx-file delegation.signed <span class="se">\</span>
    --mainnet

<span class="c1"># Delegation done, you need to wait two epochs before your delegation becomes active and 4 epochs to start receiving rewards.</span>
<span class="c1"># To confirm, you can query your address to make sure the transaction went through.</span>

cardano-cli shelley query utxo --mainnet --address <span class="k">$(</span>cat payment.addr<span class="k">)</span>
<span class="c1">#                           TxHash                                 TxIx        Lovelace</span>
<span class="c1"># ----------------------------------------------------------------------------------------</span>
<span class="c1"># 0bcdf4f6378b2183d738b17c8a2daa6a94f0ddf78133b73fccea0eece3ab1b56     0           2653774 &lt;- change from the last transaction</span>
</code></pre></div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
            Copyright © 2019-2021 Guild-Operators
          </div>
<a href="https://cardano-community.github.io/guild-operators" rel="noopener" target="_blank">
          Guild-Operators
        </a>
</div>
<div class="md-footer-social">
<a class="md-footer-social__link" href="https://github.com/cardano-community" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["search.highlight", "search.share", "navigation.indexes"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.477d984a.min.js", "version": null}</script>
<script src="../../assets/javascripts/bundle.82b56eb2.min.js"></script>
</body>
</html>