
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="https://cardano-community.github.io/guild-operators/Staking/Operators/" rel="canonical"/>
<link href="../../overrides/guildicon.png" rel="icon"/>
<meta content="mkdocs-1.2.1, mkdocs-material-7.1.9" name="generator"/>
<title>Operators - Guild Operators</title>
<link href="../../assets/stylesheets/main.ca7ac06f.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.f1a3b89f.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
<link href="../../overrides/custom.css" rel="stylesheet"/>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-MLM58HW7RF"),document.addEventListener("DOMContentLoaded",function(){"undefined"!=typeof location$&&location$.subscribe(function(t){gtag("config","G-MLM58HW7RF",{page_path:t.pathname})})})</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-MLM58HW7RF"></script>
</head>
<body data-md-color-accent="green" data-md-color-primary="green" data-md-color-scheme="slate" dir="ltr">
<script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
<script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#run-a-node-with-operational-key-certificate">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Guild Operators" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Guild Operators">
<img alt="logo" src="../../overrides/guildicon.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Guild Operators
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Operators
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="green" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="green" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31z"></path></svg>
</label>
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="green" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="green" data-md-color-scheme="default" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22z"></path></svg>
</label>
</form>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" data-md-state="active" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</label>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/cardano-community/guild-operators/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    cardano-community/guild-operators
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Guild Operators" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Guild Operators">
<img alt="logo" src="../../overrides/guildicon.png"/>
</a>
    Guild Operators
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/cardano-community/guild-operators/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    cardano-community/guild-operators
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../index.md">
        Home
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../basics/">
        Basics
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3">
        Build and Run
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Build and Run" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          Build and Run
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../build/">
        Overview
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Build/node-cli/">
        Node &amp; CLI
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Build/dbsync/">
        DBSync
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Build/pgrest/">
        PostgREST
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Build/offchain-metadata-tools/">
        Offchain Metadata Tools
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4">
        Scripts
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Scripts" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          Scripts
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../Scripts/env/">
        Common env
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" id="__nav_4_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2">
        CNTools
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="CNTools" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_2">
<span class="md-nav__icon md-icon"></span>
          CNTools
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../Scripts/cntools/">
        Overview
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Scripts/cntools-common/">
        Common Tasks
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Scripts/cntools-changelog/">
        Changelog
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Scripts/logmonitor/">
        Log Monitor
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Scripts/cncli/">
        CNCLI
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Scripts/gliveview/">
        Guild LiveView
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Scripts/topologyupdater/">
        Topology Updater
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Scripts/itnwitness/">
        ITN Metadata Proof
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Scripts/itnrewards/">
        ITN Rewards
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5">
        Docker
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Docker" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
          Docker
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../docker/docker/">
        Overview
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../docker/build/">
        Build
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../docker/run/">
        Run
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../docker/tips/">
        Tips
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6">
        Appendix
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Appendix" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
          Appendix
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../Appendix/postgres/">
        Sample Postgres Setup
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../pgrest-meetings/25Jun2021.md">
        PGRest meetings 1
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../pgrest-meetings/02Jul2021.md">
        PGRest meetings 2
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../contributors/">
        Contributors
      </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#run-a-node-with-operational-key-certificate">
    Run a node with Operational Key Certificate
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#create-stake-key-registration-certificate">
    Create stake key registration certificate
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#create-a-pool-registration-certificate">
    Create a pool registration  certificate
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#create-the-stake-owners-delegation-certificate">
    Create (the stake owner's) delegation certificate
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#submit-the-certificate-to-the-chain">
    Submit the certificate to the chain
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/cardano-community/guild-operators/edit/master/docs/Staking/Operators.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"></path></svg>
</a>
<h1>Operators</h1>
<p>!&gt; The commands used on this page are out of date and will be updated soon</p>
<p>The operator(s) is/are the stake holder(s) who operating a pools. The operators can define their operational costs in the pool certificate, that can be deducted from the rewards.</p>
<p>The objectives are the following:
  - Understand <strong>off-chain</strong> <code>operational key certificates</code>,
  - the required keys and addresses,
    - <code>payment key(s)</code> for generating <code>base</code> payment addresses,
    - <code>stake key(s)</code> for generating  <strong>pool</strong> <code>reward address(es)</code>,
  - the stake address registration process <strong>with</strong> <code>key deposit</code> and
  - the stake pool registration procedure /w pledge and other params.</p>
<p>Detailed steps are:
- Run a node with an <code>operational key certificate</code>
- Create stake key registration certificate for registering the operator's stake key (<code>staking.key</code>) on the chain, then
- Create a pool registration certificate for the node to became a stake pool (<code>pool.cert</code>),
- Create a delegation certificate for the owner (operator in our exercise) to delegate its stake as pledge to the newly creating pool (<code>deleg.cert</code>).
- Sends the <strong>on-chain</strong> certificates to the blockchain in one or more transactions.</p>
<h4 id="run-a-node-with-operational-key-certificate">Run a node with Operational Key Certificate<a class="headerlink" href="#run-a-node-with-operational-key-certificate" title="Permanent link">⚓︎</a></h4>
<p>The operational key certificates use an <strong>operational key</strong> (cold) key to grant the right to sign blocks to another key (KES) that will expire after some epochs, that is based on the genesis parameters. </p>
<p>It uses a similar mechanism to the <code>forward secure signature scheme</code> where the signing key (KES) changes over time period and the end of each time period a new signing key is computed for the next peried and the old one is erased. </p>
<p>The mechanism used for running a node with <code>operational key certificates</code> are the following: 
 1. KES (Key Evolving Signatures) that creates new (hot) KES keys periodically from the cold key
    - Create the cold (offline) key pair,
    - Create the hot KES key pairs (periodically), for signing blocks.
    - Create the <code>operational key certificate</code>
 2. Generate VRF key pair for leader selection (lottery).
 3. Run stake pool that is using the
   - non expired Operational certificate
   - non expired KES (hot) signing key
   - VRF signing key</p>
<p>Before the old hot (KES) key pair is expiring, a new <code>operational key certificate</code> needs to be created by using a newly generated hot (KES) key pair and the <strong>off-line</strong> cold signing key.</p>
<p>In production environment, it is expected that the cold key is generated by some seed generation mechanism (BIP39 or similar) and stored on computer that does not have access to the Internet and when the time arrives, the operational certificates with the hot (KES) key pairs are transferred, by some mechanism (USB stick, air gapped QR etc.) to the stake pool.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 1.1 Create cold key pair</span>
<span class="c1">##########################################</span>
<span class="nb">pushd</span>  <span class="nv">$CNODE_HOME</span> <span class="o">&amp;&amp;</span> mkdir -p ~/cold-keys <span class="o">&amp;&amp;</span> <span class="nb">pushd</span> ~/cold-keys <span class="o">||</span> <span class="nb">exit</span> <span class="m">127</span>

<span class="c1"># Generate the cold offline key pair</span>
cardano-cli shelley node key-gen <span class="se">\</span>
    --verification-key-file cold.vkey <span class="se">\</span>
    --signing-key-file cold.skey <span class="se">\</span>
    --operational-certificate-issue-counter cold.counter
<span class="nb">popd</span>

<span class="c1"># 1.2 Generate a new hot KES keypair </span>
cardano-cli shelley node key-gen-KES --verification-key-file priv/kes.vkey --signing-key-file priv/kes.skey

<span class="c1"># 1.3 Generate the ops cert based on </span>
<span class="c1"># - the `cold signing key`</span>
<span class="c1"># - the hot KES key and</span>
<span class="c1"># - the cold key's counter</span>
<span class="c1"># New periodic cert is based on the new hot KES key.</span>
<span class="c1"># kes-period tells how long the ops cert therefrore the hot KES keys are valid</span>
<span class="c1">#</span>
cardano-cli shelley node issue-op-cert <span class="se">\</span>
    --cold-signing-key-file ~/cold-keys/cold.skey <span class="se">\</span>
    --operational-certificate-issue-counter ~/cold-keys/cold.counter <span class="se">\</span>
    --hot-kes-verification-key-file priv/kes.vkey <span class="se">\</span>
    --kes-period <span class="m">0</span> <span class="se">\</span>
    --out-file priv/op.cert

<span class="c1"># 2. Generate VRF key pair for leader selection</span>
<span class="c1">#########################################################</span>
cardano-cli shelley node key-gen-VRF --verification-key-file priv/vrf.vkey --signing-key-file priv/vrf.skey

<span class="c1"># 3. Run node /w these new keys generated</span>
<span class="c1">#########################################################</span>

cardano-node run <span class="se">\</span>
  --config                          files/config.json <span class="se">\</span>
  --topology                        files/topology.json <span class="se">\</span>
  --database-path                   db <span class="se">\</span>
  --socket-path                     sockets/nodes.socket <span class="se">\</span>
  --shelley-kes-key                 priv/kes.skey <span class="se">\</span>
  --shelley-vrf-key                 priv/vrf.skey <span class="se">\</span>
  --shelley-operational-certificate priv/op.cert <span class="se">\</span>
  --port                            <span class="m">6000</span> 
</code></pre></div>
<p>I will use the initial genesis address as input for registering the:
- delegate registration certificate and
- pool registration certificate</p>
<blockquote>
<p>Keep in mind the operator also need to have its stake key registered onn the chain.</p>
</blockquote>
<h4 id="create-stake-key-registration-certificate">Create stake key registration certificate<a class="headerlink" href="#create-stake-key-registration-certificate" title="Permanent link">⚓︎</a></h4>
<p>First we need to create the operator's key in order to register the key on the chain.</p>
<p>The delegate's <code>staking key</code> needs to be registered on the blockchain in order to participating in staking, which just need a simple transaction using any <code>payment address</code>.</p>
<blockquote>
<p>This is the pool operators's stake key, and not the delegate's one. 
Therefore I prefixed them it differently i.e. <code>staking</code>, to distuinguish between the delegate's (<code>stake</code>) prefix.</p>
</blockquote>
<div class="highlight"><pre><span></span><code>mkdir operator <span class="o">&amp;&amp;</span> <span class="nb">pushd</span> operator

<span class="c1"># Generate the operator's stake keys</span>
cardano-cli shelley stake-address key-gen --verification-key-file staking.vkey --signing-key-file staking.skey

<span class="c1"># crate teh reward (staking) address from the operator's stake keys</span>
cardano-cli shelley stake-address build --stake-verification-key-file staking.vkey --testnet-magic <span class="m">42</span> &gt; staking.addr

<span class="c1"># Generate the operator's payment keys</span>
cardano-cli shelley address key-gen --verification-key-file op_pay.vkey --signing-key-file op_pay.skey

<span class="c1"># Generate an `enterprise` address for the operator.</span>
cardano-cli shelley address build --payment-verification-key-file op_pay.vkey --testnet-magic <span class="m">42</span> &gt; op_pay.addr

<span class="c1"># Generate the base address  i.e. compount `enterprise || reward` address</span>
cardano-cli shelley address build <span class="se">\</span>
    --payment-verification-key-file op_pay.vkey <span class="se">\</span>
    --stake-verification-key-file staking.vkey <span class="se">\</span>
    --testnet-magic <span class="m">42</span> &gt; base.addr
</code></pre></div>
<p>The next step is creating a stake address registration certificate.</p>
<p>For registering an <code>stake key</code> on the chain a <code>key deposit1</code> fee must be paid. The amount can be optained from the genesis for the params file e.g.:
<div class="highlight"><pre><span></span><code>cardano-cli shelley query protocol-parameters --testnet-magic <span class="m">42</span> <span class="p">|</span> tee params.json <span class="p">|</span> jq -r .keyDeposit
<span class="m">400000</span>
</code></pre></div></p>
<p>Generate the operator's stake key registration certificate </p>
<p>Keep, in mind that the a <code>key registration certificates</code> needs a deposit (<strong>keyDeposit</strong> in genesis) for the costs of tracking the key and the corresponding reward account. Also, it does not require any witness to register the certificate, but only the witness for the fees from the input of the transaction.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Keep in mind that this certificates needs a `keyDeposit` specified in the genesis.</span>
cardano-cli shelley stake-address registration-certificate <span class="se">\</span>
    --stake-verification-key-file staking.vkey <span class="se">\</span>
    --out-file staking.cert
<span class="c1"># The certificate contains the `blake2b-256` hash of the stake verifying key</span>

<span class="c1"># Calculate the min fee for the following outputs:</span>
<span class="c1"># 1. the base address that will contain the funds for pledge</span>
<span class="c1"># 2. And the change address.</span>
<span class="c1"># Keep in mind just one signing key is required, the paying signing key,</span>
<span class="c1"># as stake key reg cert does not need t obe witnessed</span>
cardano-cli shelley transaction calculate-min-fee <span class="se">\</span>
    --tx-in-count <span class="m">1</span> <span class="se">\</span>
    --tx-out-count <span class="m">2</span> <span class="se">\</span>
    --ttl <span class="m">500000</span> <span class="se">\</span>
    --testnet-magic <span class="m">42</span> <span class="se">\</span>
    --signing-key-file <span class="nv">$CNODE_HOME</span>/priv/genesis.skey <span class="se">\</span>
    --certificate-file staking.cert <span class="se">\</span>
    --protocol-params-file params.json
<span class="c1"># </span>
<span class="c1"># runTxCalculateMinFee: 174169</span>

<span class="c1"># INPUT will be based on the genesis addres (FROM)</span>
<span class="c1"># but any pay address is fine.</span>
<span class="nv">FROM</span><span class="o">=</span><span class="s2">"617190446876aed298ee207c6b5a335e832e2169a060b8167ef3ba9caff6fa3393"</span>

cardano-cli shelley query utxo --testnet-magic <span class="m">42</span> --address <span class="s2">"</span><span class="nv">$FROM</span><span class="s2">"</span>
<span class="c1">#                           TxHash                                 TxIx        Lovelace</span>
<span class="c1">#----------------------------------------------------------------------------------------</span>
<span class="c1">#c85b72ee021915f5a8349209db54a51334ad9dfcec2f0fa2619a707556017bb3     0      499999825831</span>

<span class="nv">INPUT</span><span class="o">=</span><span class="s2">"c85b72ee021915f5a8349209db54a51334ad9dfcec2f0fa2619a707556017bb3#0"</span>
<span class="nv">BALANCE</span><span class="o">=</span><span class="m">499999825831</span>
<span class="c1"># The amount will be 400K and I will pladge all of it to the pool</span>
<span class="nv">AMOUNT</span><span class="o">=</span><span class="m">400000000000</span>
<span class="nv">KEYDEP</span><span class="o">=</span><span class="m">400000</span>
<span class="nv">FEE</span><span class="o">=</span><span class="m">174169</span>
<span class="nv">CHANGE</span><span class="o">=</span><span class="s2">"</span><span class="nv">$FROM</span><span class="s2">+</span><span class="k">$((</span> <span class="m">499999825831</span> <span class="o">-</span> <span class="nv">$FEE</span> <span class="o">-</span> <span class="nv">$KEYDEP</span> <span class="o">-</span> <span class="nv">$AMOUNT</span> <span class="k">))</span><span class="s2">"</span>


<span class="c1"># So, I used the genesis UtxO to move to some staking (group) address and 500K back to it.</span>
cardano-cli shelley transaction build-raw <span class="se">\</span>
    --tx-in <span class="s2">"</span><span class="nv">$INPUT</span><span class="s2">"</span> <span class="se">\</span>
    --tx-out <span class="k">$(</span>cat base.addr<span class="k">)</span>+<span class="nv">$AMOUNT</span> <span class="se">\</span>
    --tx-out <span class="s2">"</span><span class="nv">$CHANGE</span><span class="s2">"</span> <span class="se">\</span>
    --ttl <span class="m">500000</span> <span class="se">\</span>
    --fee <span class="s2">"</span><span class="nv">$FEE</span><span class="s2">"</span> <span class="se">\</span>
    --out-file staking-cert.tx <span class="se">\</span>
    --certificate-file staking.cert

<span class="c1"># Sign it</span>
cardano-cli shelley transaction sign <span class="se">\</span>
    --tx-body-file staking-cert.tx <span class="se">\</span>
    --signing-key-file <span class="nv">$CNODE_HOME</span>/priv/genesis.skey <span class="se">\</span>
    --testnet-magic <span class="m">42</span> <span class="se">\</span>
    --out-file signed-staking-cert.tx

<span class="c1"># Submit it</span>
cardano-cli shelley transaction submit <span class="se">\</span>
    --tx-file signed-staking-cert.tx <span class="se">\</span>
    --testnet-magic <span class="m">42</span>
</code></pre></div>
<h4 id="create-a-pool-registration-certificate">Create a pool registration  certificate<a class="headerlink" href="#create-a-pool-registration-certificate" title="Permanent link">⚓︎</a></h4>
<p>A node needs a <code>pool certificate</code> registered on the blockchain for the operator to became a stake pool (<code>pool.cert</code>),</p>
<p>Now we have a 400K on the operator's <code>base address</code> and the stake key (<code>staking.key</code>) is registered.
<div class="highlight"><pre><span></span><code>cardano-cli shelley query utxo --testnet-magic <span class="m">42</span> --address <span class="k">$(</span>cat base.addr<span class="k">)</span>
                           TxHash                                 TxIx        Lovelace
----------------------------------------------------------------------------------------
863506d0e7d1afcdb558ac4b021f2e7746f3c3178faecd11e1f0349ded141a74     <span class="m">0</span>      <span class="m">400000000000</span>
</code></pre></div></p>
<p>In the operator's PoV, for registering a pool, the pool certificate must contain:
- a <code>node operational verifying key</code> a.k.a. <code>cold key</code>, for generating the pool id.
- the <code>VRF verifyig key</code> a.k.a <code>hot key</code>, for lottery, to prove that the node has the right to create and sign a block,
- an operator <code>stake verifying keys</code> for generating the reward address, where the pool rewards would be sent and
- owner's <code>stake verifying keys</code> generating the pledge <code>staking</code> address, that has enough fund for pledging.</p>
<blockquote>
<p>Note: the <code>reward account verification key</code> and the <code>owner staking verification key</code> can be the same is, see below example, if the operator is the owner too.</p>
</blockquote>
<p>Also, for registering a pool certificate a <code>pool deposit</code> must be paid too.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Createing a pools cert with</span>
<span class="c1"># - 400K of the owner's (operator in this example) 400K pledge, </span>
<span class="c1"># - 1k as cost /w </span>
<span class="c1"># - 5% margin</span>
cardano-cli shelley stake-pool registration-certificate <span class="se">\</span>
    --cold-verification-key-file ~/cold-keys/pool.vkey <span class="se">\</span>
    --vrf-verification-key-file <span class="nv">$CNODE_HOME</span>/priv/vrf.vkey <span class="se">\</span>
    --pool-pledge <span class="m">400000000000</span> <span class="se">\</span>
    --pool-cost <span class="m">1000000000</span> <span class="se">\</span>
    --pool-margin <span class="m">0</span>.05 <span class="se">\</span>
    --reward-account-verification-key-file staking.vkey <span class="se">\</span>
    --pool-owner-staking-verification-key staking.vkey <span class="se">\</span>
    --out-file pool.cert
</code></pre></div>
<h4 id="create-the-stake-owners-delegation-certificate">Create (the stake owner's) delegation certificate<a class="headerlink" href="#create-the-stake-owners-delegation-certificate" title="Permanent link">⚓︎</a></h4>
<p>For <strong>pledging</strong>, the owner (in our example the operator) must create a <code>stake delegation certificate</code> for delegating at least a <code>pledge</code> amount of stake from the owner's <code>staking key</code> specified in the pool certificate.</p>
<p>In simple words, the owner is delegating its funds (<code>pledge</code>) to the pool he/she owns.</p>
<div class="highlight"><pre><span></span><code>cardano-cli shelley stake-address delegation-certificate <span class="se">\</span>
    --stake-verification-key-file staking.vkey <span class="se">\</span>
    --cold-verification-key-file ~/cold-keys/pool.vkey <span class="se">\</span>
    --out-file owner-delegation.cert
</code></pre></div>
<h4 id="submit-the-certificate-to-the-chain">Submit the certificate to the chain<a class="headerlink" href="#submit-the-certificate-to-the-chain" title="Permanent link">⚓︎</a></h4>
<p>The certificates can be sent in one transaction.</p>
<blockquote>
<p>Please, keep in mind that the registering a pool the operator's must pay a (decaying) <code>pool deposit</code> fee.</p>
</blockquote>
<p><div class="highlight"><pre><span></span><code># grep -i poolDeposit params.json
#  "poolDeposit": 500000000,
# or 
# cardano-cli shelley query  protocol-parameters --testnet-magic 42 | jq '.poolDeposit'
# 500000000


# Calculate the fee for sending the both certificates the
# - pool registration certificate and the
# - owner's (in our case the operator's) delegating certificate.
#
# Also, it will be paid by my genesis key, but any valid `payment` signing key would do that 
# has the fee and the deposit
cardano-cli shelley transaction calculate-min-fee \
    --tx-in-count 1 \
    --tx-out-count 1 \
    --ttl 500000 \
    --testnet-magic 42 \
    --signing-key-file $CNODE_HOME/priv/genesis.skey \
    --signing-key-file staking.skey \
    --signing-key-file ~/cold-keys/pool.skey \
    --certificate-file pool.cert \
    --certificate-file owner-delegation.cert \
    --protocol-params-file ../params.json
# runTxCalculateMinFee: 184377

FEE=184377
POOLDEP=500000000

cardano-cli shelley query utxo --testnet-magic 42 --address "$FROM"
#                           TxHash                                 TxIx        Lovelace
#----------------------------------------------------------------------------------------
#863506d0e7d1afcdb558ac4b021f2e7746f3c3178faecd11e1f0349ded141a74     1       99999251662

BALANCE=99999251662
INPUT="863506d0e7d1afcdb558ac4b021f2e7746f3c3178faecd11e1f0349ded141a74#1"
CHANGE="$FROM+$(( $BALANCE - $FEE - $POOLDEP ))"

# Build
cardano-cli shelley transaction build-raw \
     --tx-in "$INPUT" \
     --tx-out "$CHANGE" \
     --ttl 500000 \
     --fee "$FEE" \
     --out-file pool-cert.tx \
     --certificate-file pool.cert \
     --certificate-file owner-delegation.cert 

# Sign
# - the `genesis.skey` needs for signing the payment from the $FROM address.
# - the `staking.skey` needs for signing the owner's delegation certificate.
# - the `pool.skey` needs for signing the pool's registration certificate.
cardano-cli shelley transaction sign \
    --tx-body-file pool-cert.tx \
    --signing-key-file $CNODE_HOME/priv/genesis.skey \
    --signing-key-file staking.skey \
    --signing-key-file ~/cold-keys/pool.skey \
    --testnet-magic 42 \
    --out-file signed-pool-cert.tx

# Submit:
cardano-cli shelley transaction submit \
    --tx-file signed-pool-cert.tx \
    --testnet-magic 42
</code></pre></div>
Done your pool is registered.</p>
<p>To check it you can you the following command:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Get the Pool Id whihc is in the owner-delegation.cert</span>
<span class="nv">POOL_ID</span><span class="o">=</span><span class="k">$(</span> tail -1 owner-delegation.cert <span class="p">|</span> cut -c <span class="m">6</span>- <span class="k">)</span>
<span class="nb">echo</span> <span class="nv">$POOL_ID</span>
<span class="c1"># 5820d07e860c52860d92373893b27d6926e6610c925f905eba40d8e930004bf2dc44</span>
shelley query ledger-state  --testnet-magic <span class="m">42</span> <span class="p">|</span> grep <span class="s2">"poolPubKey"</span> <span class="p">|</span> grep  <span class="s2">"</span><span class="nv">$POOL_ID</span><span class="s2">"</span>
<span class="c1">#                    "_poolPubKey": "d07e860c52860d92373893b27d6926e6610c925f905eba40d8e930004bf2dc44",</span>
</code></pre></div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
            Copyright © 2019-2021 Guild-Operators
          </div>
<a href="https://cardano-community.github.io/guild-operators" rel="noopener" target="_blank">
          Guild-Operators
        </a>
</div>
<div class="md-footer-social">
<a class="md-footer-social__link" href="https://github.com/cardano-community" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["search.highlight", "search.share", "navigation.indexes"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.477d984a.min.js", "version": null}</script>
<script src="../../assets/javascripts/bundle.82b56eb2.min.js"></script>
</body>
</html>