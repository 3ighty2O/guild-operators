<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js ayu">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Cardano Community managed Documentation for Pool Operators</title>
        
        <meta name="robots" content="noindex" />
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="Home.html">Getting Started</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="architecture.html">Architecture</a></li><li class="chapter-item expanded "><a href="Build-and-Run.html">Build and Run</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Common.html">Common</a></li><li class="chapter-item expanded "><a href="node-cli.html">Node and CLI</a></li><li class="chapter-item expanded "><a href="wallet.html">Wallet</a></li><li class="chapter-item expanded "><a href="rest.html">REST</a></li><li class="chapter-item expanded "><a href="dbsync.html">DBSync tool</a></li><li class="chapter-item expanded "><a href="graphql.html">GraphQL</a></li></ol></li><li class="chapter-item expanded "><a href="Setup-BFT-Member.html">Set up and connect to the network as BFT leader</a></li><li class="chapter-item expanded "><a href="Setup-Passive-Member.html">Set up and connect to the network as a passive member</a></li><li class="chapter-item expanded "><a href="cli-scripts.html">Useful Scripts</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="createAddr.html">Create Keys/Address</a></li><li class="chapter-item expanded "><a href="sendADA.html">Make Transactions</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="Home.html">Appendix</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="postgres.html">Sample Postgres Setup</a></li></ol></li><li class="chapter-item expanded "><a href="Contributors.html">Contributors</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu (default)</button></li>
                        </ul>
                    </div>

                    <h1 class="menu-title">Cardano Community managed Documentation for Pool Operators</h1>

                    <div class="right-buttons">
                        
                        <a href="https://github.com/cardano-community/guild-operators/blob/master/docs/print.md" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h3><a class="header" href="#welcome" id="welcome">Welcome!!</a></h3>
<p>This documentation (rather the repository itself) is created by some of the community members and serves as an easy means to add documentation or scripts that makes more sense to users. The target audience for this document are mainly experienced stake pool operators.</p>
<p>The repository is already open to collaboration from many members within community. We would love community contributions and verification of the instructions, rather than having 100 versions of documentations. If there are any discrepancies/suggestions/contributions for this document, please open a issue and one of the collaborators should be able to add the changes in.</p>
<h4><a class="header" href="#getting-started-with-haskell-node" id="getting-started-with-haskell-node">Getting started with Haskell Node</a></h4>
<p>Use the sidebar to navigate through the topics. Note that the instructions assume the folder structure as per Next topic, you're expected to update the folder reference as per your environment.
Also, since you cannot run a Praos node yet, the instructions here-in allow you to join a private haskell testnet network (phtn), we will gradually update to Praos version and update the phtn references.</p>
<p><em>Note that current version of documentation connects you to cardano-node, which is stable for using permissive oBFT consensus - the shelley (Praos) codebase is not yet in a state where we can run a network from it. While we would like to onboard new features as they're built for Shelley codebase (e.g. hybrid of oBFT nodes run by bootstrap entities and Praos nodes by stakepool operators), it is best to set your expectation accordingly. In the current state, this serves as a useful means to get familiar with modular architecture and usage.</em></p>
<h3><a class="header" href="#architecture" id="architecture">Architecture</a></h3>
<p>The architecture and description of various components are best described at <a href="https://input-output-hk.github.io/adrestia/docs/architecture/">Adrestia User Guide</a> by IOHK, which you can also view below.</p>
<div>
<iframe src="https://input-output-hk.github.io/adrestia/docs/architecture/" frameborder="0" class="adrestia-arch"></iframe></div>
<h3><a class="header" href="#build-and-run" id="build-and-run">Build and Run</a></h3>
<p>This document is built using instructions from <a href="https://github.com/input-output-hk">IOHK repositories</a> as base with additional info/clarification, which we can propose to add if it makes sense.</p>
<p><strong>The instructions are intentionally limited to cabal</strong> to avoid wait times/availability of nix/docker/stack.yaml files on what we expect to be rapidly developing codebase - this will also help prevent managing multiple versions of instructions (atleast for now).</p>
<p>Note that the instructions are mainly focused around building Cardano components and OS/thirdparty software (eg: postgres) setup instructions are intended to provide build level information only.</p>
<p>Ofcourse, we can always add links with specific best practices to those instructions - for those who would like to contribute, please open a PR directly on the <a href="https://github.com/cardano-community/guild-operators/tree/master/docs">github repo</a> to do so.</p>
<h4><a class="header" href="#docker-builds" id="docker-builds">Docker Builds:</a></h4>
<p>If you would want to go down the docker route, the basic instructions to get you set up with docker itself are below, while the you can follow <a href="https://input-output-hk.github.io/adrestia/docs/installation/">IOHK Adrestia documentation</a> for latest release information:</p>
<pre><code class="language-bash"># CentOS
sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
sudo yum install https://download.docker.com/linux/centos/7/x86_64/stable/Packages/containerd.io-1.2.6-3.3.el7.x86_64.rpm
sudo yum install -y docker-ce docker-ce-cli
sudo systemctl enable docker
sudo chkconfig docker on

## These steps would be automatically performed by the install above
# sudo groupadd docker
# sudo usermod -aG docker $USER
sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.25.5/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/bin/docker-compose;chmod 755 /usr/bin/docker-compose
</code></pre>
<h3><a class="header" href="#pre-requisites" id="pre-requisites">Pre-Requisites</a></h3>
<h4><a class="header" href="#dependencies-and-folder-structure-setup" id="dependencies-and-folder-structure-setup">Dependencies and Folder Structure setup</a></h4>
<p>The pre-requisites for Linux systems are automated to be executed as a single script. Follow the instructions below to deploy the same:</p>
<pre><code class="language-bash">mkdir &quot;$HOME/tmp&quot;;cd &quot;$HOME/tmp&quot;
# Install wget
# CentOS / RedHat - sudo dnf -y install wget
# Ubuntu / Debian - sudo apt -y install wget
wget https://raw.githubusercontent.com/cardano-community/guild-operators/master/files/ptn0/scripts/prereqs.sh
chmod 755 prereqs.sh
# Ensure you can run sudo commands with your user before execution
./prereqs.sh
. &quot;${HOME}/.bashrc&quot;
## Follow the prompts for execution
</code></pre>
<h4><a class="header" href="#folder-structure" id="folder-structure">Folder structure</a></h4>
<p>Running the script above will create the folder structure as per below, for your reference.</p>
<pre><code>/opt/cardano/cnode          # Top-Level Folder
├── ...
├── files                   # Config, genesis and topology files
│   ├── ...
│   ├── genesis.json        # Genesis file referenced in ptn0.yaml
│   ├── ptn0.yaml           # Config file used by cardano-node
│   └── inventory.json      # Map of Real-PBFT chain for cardano-node
├── db                      # DB Store for cardano-node
├── logs                    # Logs for cardano-node
├── priv                    # Folder to store your keys (permission: 600)
├── scripts                 # Scripts to start and interact with cardano-node
├── sockets                 # Socket files created by cardano-node
└── ...
</code></pre>
<h3><a class="header" href="#cardano-node-and-cardano-cli" id="cardano-node-and-cardano-cli">Cardano Node and Cardano CLI</a></h3>
<p>Ensure the <a href="Common.html#dependencies-and-folder-structure-setup">Pre-Requisites</a> are in place before you proceed.</p>
<h4><a class="header" href="#build-instructions" id="build-instructions">Build Instructions</a></h4>
<p>Run the commands below to clone the Cardano Node git repository and build the binaries:</p>
<pre><code class="language-bash">cd ~/git
git clone https://github.com/input-output-hk/cardano-node
cd cardano-node
$CNODE_HOME/scripts/cabal-build-all.sh
</code></pre>
<p>The above would copy the binaries built into ~/.cabal/bin folder.</p>
<h4><a class="header" href="#verify" id="verify">Verify</a></h4>
<p>Execute cardano-cli and cardano-node to verify output as below:</p>
<pre><code class="language-bash">cardano-cli version
# cardano-cli 1.11.0 - linux-x86_64 - ghc-8.6
cardano-node
#Usage: cardano-node (run | run-mock) [--help]
#  Start node of the Cardano blockchain.
#
#Available options:
#  --help                   Show this help text
#
#Execute node with a real protocol.
#  run                      Execute node with a real protocol.
#
#Execute node with a mock protocol.
#  run-mock                 Execute node with a mock protocol.
</code></pre>
<h3><a class="header" href="#cardano-wallet" id="cardano-wallet">Cardano Wallet</a></h3>
<p>Ensure the <a href="Common.html#dependencies-and-folder-structure-setup">Pre-Requisites</a> are in place before you proceed.</p>
<h4><a class="header" href="#build-instructions-1" id="build-instructions-1">Build Instructions</a></h4>
<p>Follow instructions below for building the cardano-wallet binary:</p>
<pre><code class="language-bash">cd ~/git
git clone https://github.com/input-output-hk/cardano-wallet
cd cardano-wallet
$CNODE_HOME/scripts/stack-build.sh
# TODO: Replace stack with cabal, once fixed
# 
</code></pre>
<p>The above would copy the binaries into ~/.cabal/bin folder.</p>
<h4><a class="header" href="#start-the-wallet-server" id="start-the-wallet-server">Start the wallet server</a></h4>
<pre><code class="language-bash">cardano-wallet-byron serve --node-socket $CNODE_HOME/sockets/pbft_node.socket --testnet $CNODE_HOME/files/genesis.json --database $CNODE_HOME/priv/wallet
</code></pre>
<h4><a class="header" href="#verify-the-wallet-is-handling-requests" id="verify-the-wallet-is-handling-requests">Verify the wallet is handling requests</a></h4>
<pre><code class="language-bash">cardano-wallet-byron network information
</code></pre>
<p>Expected output should be similar to the following</p>
<pre><code class="language-json">Ok.
{
    &quot;network_tip&quot;: {
        &quot;epoch_number&quot;: 4,
        &quot;slot_number&quot;: 730
    },
    &quot;node_tip&quot;: {
        &quot;height&quot;: {
            &quot;quantity&quot;: 2390,
            &quot;unit&quot;: &quot;block&quot;
        },
        &quot;epoch_number&quot;: 4,
        &quot;slot_number&quot;: 728
    },
    &quot;sync_progress&quot;: {
        &quot;status&quot;: &quot;ready&quot;
    },
    &quot;next_epoch&quot;: {
        &quot;epoch_start_time&quot;: &quot;2020-04-27T09:48:35Z&quot;,
        &quot;epoch_number&quot;: 5
    }
}
</code></pre>
<h4><a class="header" href="#create-a-new-wallet" id="create-a-new-wallet">Create a new wallet</a></h4>
<h5><a class="header" href="#first-generate-a-mnemonic-phrase" id="first-generate-a-mnemonic-phrase">First generate a mnemonic phrase</a></h5>
<pre><code class="language-bash">cardano-wallet-byron mnemonic generate
# false brother typical saddle settle phrase foster sauce ask sunset firm gate service render burger
</code></pre>
<h5><a class="header" href="#generate-a-new-byron-wallet-from-your-mnemonic-phrase" id="generate-a-new-byron-wallet-from-your-mnemonic-phrase">Generate a new byron wallet from your mnemonic phrase</a></h5>
<pre><code class="language-bash">cardano-wallet-byron wallet create from-mnemonic --wallet-style icarus &quot;Guild Test Wallet&quot;
</code></pre>
<h5><a class="header" href="#expected-output" id="expected-output">Expected output:</a></h5>
<pre><code class="language-text">Please enter 15 mnemonic words : false brother typical saddle settle phrase foster sauce ask sunset firm gate service render burger
Please enter a passphrase: ******************
Enter the passphrase a second time: ******************
Ok.
{
    &quot;passphrase&quot;: {
        &quot;last_updated_at&quot;: &quot;2020-04-27T06:35:19.48354187Z&quot;
    },
    &quot;state&quot;: {
        &quot;status&quot;: &quot;syncing&quot;,
        &quot;progress&quot;: {
            &quot;quantity&quot;: 0,
            &quot;unit&quot;: &quot;percent&quot;
        }
    },
    &quot;discovery&quot;: &quot;sequential&quot;,
    &quot;balance&quot;: {
        &quot;total&quot;: {
            &quot;quantity&quot;: 0,
            &quot;unit&quot;: &quot;lovelace&quot;
        },
        &quot;available&quot;: {
            &quot;quantity&quot;: 0,
            &quot;unit&quot;: &quot;lovelace&quot;
        }
    },
    &quot;name&quot;: &quot;Guild Test Wallet&quot;,
    &quot;id&quot;: &quot;0854da56dd00ae2099a499303681826506527ac7&quot;,
    &quot;tip&quot;: {
        &quot;height&quot;: {
            &quot;quantity&quot;: 0,
            &quot;unit&quot;: &quot;block&quot;
        },
        &quot;epoch_number&quot;: 0,
        &quot;slot_number&quot;: 0
    }
}
</code></pre>
<h3><a class="header" href="#cardano-rest" id="cardano-rest">Cardano Rest</a></h3>
<p>Ensure the <a href="Common.html#dependencies-and-folder-structure-setup">Pre-Requisites</a> are in place before you proceed.</p>
<h4><a class="header" href="#build-instructions-2" id="build-instructions-2">Build Instructions</a></h4>
<p>Clone the cardano-rest repository from github</p>
<pre><code class="language-bash">cd ~/git
git clone https://github.com/input-output-hk/cardano-rest.git
cd cardano-rest
$CNODE_HOME/scripts/cabal-build-all.sh
</code></pre>
<p>The above would copy the binaries into ~/.cabal/bin folder.</p>
<h4><a class="header" href="#start-the-rest-server" id="start-the-rest-server">Start the REST server</a></h4>
<p>Execute the below to start the Cardano Explorer API Server:</p>
<pre><code class="language-bash">export PGPASSFILE=$CNODE_HOME/priv/.pgpass
cardano-explorer-api
# Running full server on http://localhost:8100/
</code></pre>
<h4><a class="header" href="#verify-the-rest-server-is-functioning" id="verify-the-rest-server-is-functioning">Verify the REST server is functioning</a></h4>
<p>Verify that you can query the API Server using instruction below:</p>
<pre><code class="language-bash">curl http://localhost:8100/api/blocks/pages
</code></pre>
<p>Expected output should be similar to the following:</p>
<pre><code class="language-json">{&quot;Right&quot;:[261,[{&quot;cbeEpoch&quot;:4,&quot;cbeSlot&quot;:9345,&quot;cbeBlkHeight&quot;:2605,&quot;cbeBlkHash&quot;:&quot;9026612cfa53b7f8a84ff62c4e897830db9ab6ce24b19e0059f4b4db7a14c0f9&quot;,&quot;cbeTimeIssued&quot;:1587974365,&quot;cbeTxNum&quot;:0,&quot;cbeTotalSent&quot;:{&quot;getCoin&quot;:&quot;0&quot;},&quot;cbeSize&quot;:631,&quot;cbeBlockLead&quot;:&quot;464835a0904109be93d7996b9b4acc486f6c8f75a595b2c4392f9521&quot;,&quot;cbeFees&quot;:{&quot;getCoin&quot;:&quot;0&quot;}},{&quot;cbeEpoch&quot;:4,&quot;cbeSlot&quot;:9341,&quot;cbeBlkHeight&quot;:2604,&quot;cbeBlkHash&quot;:&quot;24000e2986bbfbfd610cb105d3697cce7582b8570469c4ff944b91d7dd0dc58f&quot;,&quot;cbeTimeIssued&quot;:1587974325,&quot;cbeTxNum&quot;:0,&quot;cbeTotalSent&quot;:{&quot;getCoin&quot;:&quot;0&quot;},&quot;cbeSize&quot;:631,&quot;cbeBlockLead&quot;:&quot;1ce88674d08d7813c5281e38e8a43b51550292f0bd8907b17a62eef2&quot;,&quot;cbeFees&quot;:{&quot;getCoin&quot;:&quot;0&quot;}},{&quot;cbeEpoch&quot;:4,&quot;cbeSlot&quot;:9338,&quot;cbeBlkHeight&quot;:2603,&quot;cbeBlkHash&quot;:&quot;5c2737421b223d1ab67f1046f8841d57d7f8456b77a841702fbb18bccf71a216&quot;,&quot;cbeTimeIssued&quot;:1587974295,&quot;cbeTxNum&quot;:0,&quot;cbeTotalSent&quot;:{&quot;getCoin&quot;:&quot;0&quot;},&quot;cbeSize&quot;:631,&quot;cbeBlockLead&quot;:&quot;f6a4cfa43cef5ebed8fbd0527153f9896d1f9dd83bd1d55e609d622b&quot;,&quot;cbeFees&quot;:{&quot;getCoin&quot;:&quot;0&quot;}},{&quot;cbeEpoch&quot;:4,&quot;cbeSlot&quot;:9333,&quot;cbeBlkHeight&quot;:2602,&quot;cbeBlkHash&quot;:&quot;496db1bc19d609687185e394cfcb8fa15e8df652c7dc40a58a347e30b9e4a25f&quot;,&quot;cbeTimeIssued&quot;:1587974245,&quot;cbeTxNum&quot;:0,&quot;cbeTotalSent&quot;:{&quot;getCoin&quot;:&quot;0&quot;},&quot;cbeSize&quot;:631,&quot;cbeBlockLead&quot;:&quot;a7cad2c48edecff1627bac50aab5fcc6831f6ab91131721269850805&quot;,&quot;cbeFees&quot;:{&quot;getCoin&quot;:&quot;0&quot;}},{&quot;cbeEpoch&quot;:4,&quot;cbeSlot&quot;:9332,&quot;cbeBlkHeight&quot;:2601,&quot;cbeBlkHash&quot;:&quot;8a837d43685dd350c6f1773b1ede7843d56d093a425ff4ccd799f7ff1b76204d&quot;,&quot;cbeTimeIssued&quot;:1587974235,&quot;cbeTxNum&quot;:0,&quot;cbeTotalSent&quot;:{&quot;getCoin&quot;:&quot;0&quot;},&quot;cbeSize&quot;:631,&quot;cbeBlockLead&quot;:&quot;a18aa0130f67053ed1cb346813054e160687a8ee7602a549f8ae165b&quot;,&quot;cbeFees&quot;:{&quot;getCoin&quot;:&quot;0&quot;}}]]}
</code></pre>
<h3><a class="header" href="#dbsync-tool" id="dbsync-tool">DBSync tool</a></h3>
<p>Cardano DB Sync tool relies on an existing PostgreSQL server. To keep the focus on building dbsync tool, and not how to setup postgres itself, you can refer to <a href="postgres.html">Sample Local PostgreSQL Server Deployment instructions</a> for setting up Postgres instance.</p>
<p>Ensure the <a href="Common.html#dependencies-and-folder-structure-setup">Pre-Requisites</a> are in place before you proceed.</p>
<h4><a class="header" href="#build-cardano-db-sync" id="build-cardano-db-sync">Build cardano-db-sync</a></h4>
<p>To build instructions for cardano-db-sync tool will be similar to cardano-node:</p>
<pre><code class="language-bash">cd ~/git
git clone https://github.com/input-output-hk/cardano-db-sync
cd cardano-db-sync
$CNODE_HOME/scripts/cabal-build-all.sh
</code></pre>
<p>Similar to before, <code>cardano-db-sync</code> and <code>cardano-db-sync-extended</code> should now be available in ~/.cabal/bin folder.</p>
<h4><a class="header" href="#prepare-db-for-cardano-db-sync-" id="prepare-db-for-cardano-db-sync-">Prepare DB for cardano-db-sync :</a></h4>
<pre><code class="language-bash">cd ~/git/cardano-db-sync
# scripts/postgresql-setup.sh --dropdb #if exists already, will fail if it doesnt - thats OK
scripts/postgresql-setup.sh --createdb
# Password:
# Password:
# All good!
## Verify you can see &quot;All good!&quot; as above
</code></pre>
<h4><a class="header" href="#start-cardano-db-sync-tool" id="start-cardano-db-sync-tool">Start cardano-db-sync-tool</a></h4>
<pre><code class="language-bash">cd ~/git/cardano-db-sync
PGPASSFILE=$CNODE_HOME/priv/.pgpass cardano-db-sync-extended --config /opt/cardano/cnode/files/ptn0.yaml --genesis-file /opt/cardano/cnode/files/genesis.json --socket-path /opt/cardano/cnode/sockets/pbft_node.socket --schema-dir schema/
</code></pre>
<p>You can use same instructions above to repeat and execute <code>cardano-db-sync</code> as well, but <a href="./graphql.html">cardano-graphql</a> uses <code>cardano-db-sync-extended</code>, so we'll stick to it</p>
<h4><a class="header" href="#validation" id="validation">Validation</a></h4>
<p>To validate, connect to postgres instance and execute commands as per below:</p>
<pre><code class="language-bash">export PGPASSFILE=$CNODE_HOME/priv/.pgpass
psql cexplorer_phtn
</code></pre>
<p>You should be at the psql prompt, you can check the tables and verify they're populated:</p>
<pre><code class="language-sql">\dt
#            List of relations
# Schema |      Name      | Type  | Owner
#--------+----------------+-------+-------
# public | block          | table | &lt;username&gt;
# public | epoch          | table | &lt;username&gt;
# public | meta           | table | &lt;username&gt;
# public | schema_version | table | &lt;username&gt;
# public | slot_leader    | table | &lt;username&gt;
# public | tx             | table | &lt;username&gt;
# public | tx_in          | table | &lt;username&gt;
# public | tx_out         | table | &lt;username&gt;
#(8 rows)

select * from meta;
# id | protocol_const | slot_duration |     start_time      | network_name
#----+----------------+---------------+---------------------+--------------
#  1 |          43200 |         20000 | 2020-04-12 13:55:37 | pHTN
#(1 row)

select * from tx;
# id |                                hash                                | block | fee |     out_sum      | size
#----+--------------------------------------------------------------------+-------+-----+------------------+------
#  1 | \x26b63ce785b16fc53ba3ab882ac0e5342a77b33f355ba82982e3e2d5e05500df |     1 |   0 |       1000000000 |    0
#  2 | \xbd8f661658dabbb557d4b5e23264d34fda2a2304daccdac283e337581a88c479 |     1 |   0 |   62499975000000 |    0
#  3 | \x17fbf571b7d091e9cfb6853cd5fb603031831ce7e5e3acbb4b842960e90ba419 |     1 |   0 |   62499975000000 |    0
#  4 | \x3e7e3c1105d3bd76a2b5ae897e1b79b86c7834e68409e533afc318112405ff69 |     1 |   0 |   62499975000000 |    0
# ...
# (36 rows)
</code></pre>
<h3><a class="header" href="#graphql" id="graphql">GraphQL</a></h3>
<p>Ensure the <a href="Common.html#dependencies-and-folder-structure-setup">Pre-Requisites</a> are in place before you proceed.</p>
<h4><a class="header" href="#build-hasura-graphql-engine" id="build-hasura-graphql-engine">Build Hasura graphql-engine</a></h4>
<p>Going with the spirit of the documentation here, instruction to build the graphql-engine binary :)</p>
<pre><code class="language-bash">cd ~/git
git clone https://github.com/hasura/graphql-engine
cd graphql-engine/server
$CNODE_HOME/scripts/cabal-build-all.sh
</code></pre>
<p>This should make <code>graphql-engine</code> available at ~/.cabal/bin.</p>
<h4><a class="header" href="#build-cardano-graphql" id="build-cardano-graphql">Build cardano-graphql</a></h4>
<p>The build will fail if you are running a version of node.js earlier than 10.0.0 (which could happen if you have a conflicting version in your $PATH). You can verify your node version by executing the below:</p>
<pre><code class="language-bash">#check your version of node.js
node -v
#if response is 10.0.0 or higher build can proceed. 
</code></pre>
<p>The commands below will help you compile the cardano-graphql node:</p>
<pre><code class="language-bash">cd ~/git
git clone https://github.com/input-output-hk/cardano-graphql
cd cardano-graphql
git checkout v1.1.1
yarn
#yarn install v1.22.4
# [1/4] Resolving packages...
# [2/4] Fetching packages...
# info fsevents@2.1.2: The platform &quot;linux&quot; is incompatible with this module.
# info &quot;fsevents@2.1.2&quot; is an optional dependency and failed compatibility check. Excluding it from installation.
# info fsevents@1.2.12: The platform &quot;linux&quot; is incompatible with this module.
# info &quot;fsevents@1.2.12&quot; is an optional dependency and failed compatibility check. Excluding it from installation.
# [3/4] Linking dependencies...
# warning &quot; &gt; graphql-type-datetime@0.2.4&quot; has incorrect peer dependency &quot;graphql@^0.13.2&quot;.
# warning &quot; &gt; @typescript-eslint/eslint-plugin@1.13.0&quot; has incorrect peer dependency &quot;eslint@^5.0.0&quot;.
# warning &quot; &gt; @typescript-eslint/parser@1.13.0&quot; has incorrect peer dependency &quot;eslint@^5.0.0&quot;.
# [4/4] Building fresh packages...
# Done in 20.70s.
yarn build
# yarn run v1.22.4
# $ yarn codegen:internal &amp;&amp; yarn codegen:external &amp;&amp; tsc -p . &amp;&amp; shx cp src/schema.graphql dist/
# $ graphql-codegen
#   ✔ Parse configuration
#   ✔ Generate outputs
# $ graphql-codegen --config ./codegen.external.yml
#   ✔ Parse configuration
#   ✔ Generate outputs
# Done in 38.11s.
cd dist
rsync -arvh ../node_modules ./
</code></pre>
<h4><a class="header" href="#set-up-environment-for-cardano-graphql" id="set-up-environment-for-cardano-graphql">Set up environment for cardano-graphql</a></h4>
<p>cardano-graphql requires cardano-node, cardano-db-sync-extended, postgresql and graphql-engine to be set up and running.
The below will help you map the components:</p>
<pre><code class="language-bash">export PGPASSFILE=$CNODE_HOME/priv/.pgpass
IFS=':' read -r -a PGPASS &lt;&lt;&lt; $(cat $PGPASSFILE)
export HASURA_GRAPHQL_ENABLE_TELEMETRY=false  # Optional.  To send usage data to Hasura, set to true.
export HASURA_GRAPHQL_DATABASE_URL=postgres://${PGPASS[3]}:${PGPASS[4]}@${PGPASS[0]}:${PGPASS[1]}/${PGPASS[2]}
export HASURA_GRAPHQL_ENABLE_CONSOLE=true
export HASURA_GRAPHQL_ENABLED_LOG_TYPES=&quot;startup, http-log, webhook-log, websocket-log, query-log&quot;
export HASURA_GRAPHQL_SERVER_PORT=4080
export HASURA_GRAPHQL_SERVER_HOST=0.0.0.0
export CACHE_ENABLED=true
export HASURA_URI=http://127.0.0.1:4080
cd ~/git/cardano-graphql/dist
graphql-engine serve &amp;
node index.js
</code></pre>
<h3><a class="header" href="#config-for-phtn---as-a-bft-member" id="config-for-phtn---as-a-bft-member">Config for pHTN - as a BFT Member</a></h3>
<p>Use this guide only if you already have your key (referred to as pbft0.key below) that's already registered in genesis.</p>
<h4><a class="header" href="#create-verification-key" id="create-verification-key">Create verification key</a></h4>
<pre><code class="language-bash"># Create the verification key
cardano-cli to-verification --real-pbft --secret $CNODE_HOME/priv/pbft0.key --to $CNODE_HOME/priv/pbft0.vfk

# Check the verification/public key
cardano-cli signing-key-public --real-pbft --secret $CNODE_HOME/priv/pbft0.key | awk '/base64/ { print $4}'
# HyZ+SQ3odbYPH...A==
cat $CNODE_HOME/priv/pbft0.vfk
# HyZ+SQ3odbYPH...A==
</code></pre>
<h4><a class="header" href="#extract-your-cert-from-genesis-using-below" id="extract-your-cert-from-genesis-using-below">Extract your cert from genesis using below</a></h4>
<pre><code class="language-bash"># Extract cert from genesis.
grep `cat $CNODE_HOME/priv/pbft0.vfk` -B 4 -A 3 $CNODE_HOME/files/genesis.json | sed -e 's@^.*{@{@' -e 's@^.*},@}@' &gt; $CNODE_HOME/priv/pbft0.json
</code></pre>
<h4><a class="header" href="#start-node" id="start-node">Start Node</a></h4>
<pre><code class="language-bash"># Run the node
cd $CNODE_HOME/scripts
./cnode.sh
</code></pre>
<h3><a class="header" href="#config-for-phtn---as-a-passive-node" id="config-for-phtn---as-a-passive-node">Config for pHTN - as a Passive node</a></h3>
<h4><a class="header" href="#create-signing-and-verifying-keys" id="create-signing-and-verifying-keys">Create signing and verifying keys</a></h4>
<pre><code class="language-bash">$ cardano-cli keygen --real-pbft --secret $CNODE_HOME/priv/pbft0p.key --no-password
</code></pre>
<h4><a class="header" href="#create-verification-key-1" id="create-verification-key-1">Create verification key</a></h4>
<pre><code class="language-bash"># Create the verification key
cardano-cli to-verification --real-pbft --secret $CNODE_HOME/priv/pbft0p.key --to $CNODE_HOME/priv/pbft0p.vfk

# Check the verification/public key
cardano-cli signing-key-public --real-pbft --secret $CNODE_HOME/priv/pbft0p.key | awk '/base64/ { print $4}'
# HyZ+SQ3odbYPH...A==
cat $CNODE_HOME/priv/pbft0p.vfk
# HyZ+SQ3odbYPH...A==
</code></pre>
<h4><a class="header" href="#create-certificates" id="create-certificates">Create certificates</a></h4>
<pre><code class="language-bash">$ cardano-cli issue-delegation-certificate \
--config $CNODE_HOME/files/config.json \
--since-epoch &lt;?&gt; \
--secret &lt;THE ISSUER SECRET/KEY FOR GENESIS&gt; \
--delegate-key $CNODE_HOME/priv/pbft0p.key \
--certificate $CNODE_HOME/files/pbft0p.json
</code></pre>
<h4><a class="header" href="#start-passive-node" id="start-passive-node">Start Passive Node</a></h4>
<pre><code class="language-bash">CNODE_HOME=/opt/cardano/cnode
cardano-node run \
          --config $CNODE_HOME/files/ptn0.yaml \
          --database-path $CNODE_HOME/db \
          --host-addr $(curl ifconfig.me) \
          --port 9000 \
          --socket-path $CNODE_HOME/sockets/0 \
          --topology $CNODE_HOME/files/topology.json
</code></pre>
<h3><a class="header" href="#collection-of-value-added-scripts" id="collection-of-value-added-scripts">Collection of Value-added scripts</a></h3>
<p>A place to collect scripts that are supposed to help with usage of Cardano-node. The attempt with these scripts is to keep things similar to the popular jormungandr scripts that pool operators in ITN have been accustomed to. Use the navigation menu on the left to drill down to specific script.</p>
<h3><a class="header" href="#create-keysaddress" id="create-keysaddress">Create Keys/Address</a></h3>
<p>This script assists you to create a Private key file and generates a corresponding address script for it</p>
<pre><code class="language-bash">cd $CNODE_HOME/scripts
./createAddr.sh pbft1
# Sample output to enter passphrase (can be left empty, you will need this passphrase to access the key if filled):
# Enter password to encrypt 'pbft1':
# Repeat to validate:
</code></pre>
<h3><a class="header" href="#make-transactions" id="make-transactions">Make Transactions</a></h3>
<p>This script will create and submit a transaction to send ADA using one of the BFT keys as source and an address specified on command line</p>
<pre><code># Send ADA script usage
cd $CNODE_HOME/scripts
./sendADA.sh tx.out 2cWKMJemoBa....ssL7fzhq 20 $CNODE_HOME/priv/pbft0.key
</code></pre>
<h3><a class="header" href="#welcome-1" id="welcome-1">Welcome!!</a></h3>
<p>This documentation (rather the repository itself) is created by some of the community members and serves as an easy means to add documentation or scripts that makes more sense to users. The target audience for this document are mainly experienced stake pool operators.</p>
<p>The repository is already open to collaboration from many members within community. We would love community contributions and verification of the instructions, rather than having 100 versions of documentations. If there are any discrepancies/suggestions/contributions for this document, please open a issue and one of the collaborators should be able to add the changes in.</p>
<h4><a class="header" href="#getting-started-with-haskell-node-1" id="getting-started-with-haskell-node-1">Getting started with Haskell Node</a></h4>
<p>Use the sidebar to navigate through the topics. Note that the instructions assume the folder structure as per Next topic, you're expected to update the folder reference as per your environment.
Also, since you cannot run a Praos node yet, the instructions here-in allow you to join a private haskell testnet network (phtn), we will gradually update to Praos version and update the phtn references.</p>
<p><em>Note that current version of documentation connects you to cardano-node, which is stable for using permissive oBFT consensus - the shelley (Praos) codebase is not yet in a state where we can run a network from it. While we would like to onboard new features as they're built for Shelley codebase (e.g. hybrid of oBFT nodes run by bootstrap entities and Praos nodes by stakepool operators), it is best to set your expectation accordingly. In the current state, this serves as a useful means to get familiar with modular architecture and usage.</em></p>
<h3><a class="header" href="#sample-postgres-deployment-instructions" id="sample-postgres-deployment-instructions">Sample Postgres Deployment instructions</a></h3>
<p>These deployment instructions used for reference while building <a href="dbsync.html">cardano-db-sync</a> tool. These are just for reference and ease of set up and consistency for those who are new to Postgres DB.
It is recommended to customise these as per your needs for Production builds.</p>
<h4><a class="header" href="#install-postgresql-server" id="install-postgresql-server">Install PostgreSQL Server</a></h4>
<p>Execute commands below to set up Postgres Server</p>
<pre><code class="language-bash"># Determine OS platform
OS_ID=$(grep -i ^id_like= /etc/os-release | cut -d= -f 2)
DISTRO=$(grep -i ^NAME= /etc/os-release | cut -d= -f 2)

if [ -z &quot;${OS_ID##*debian*}&quot; ]; then
  #Debian/Ubuntu
  wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -
  RELEASE=$(lsb_release -cs)
  echo &quot;deb http://apt.postgresql.org/pub/repos/apt/ ${RELEASE}&quot;-pgdg main | sudo tee  /etc/apt/sources.list.d/pgdg.list
  sudo apt-get update
  sudo apt-get -y install postgresql-11 postgresql-server-dev-11 postgresql-contrib libghc-hdbc-postgresql-dev
  sudo sed -i &quot;s#  ident#  md5#g&quot; /etc/postgresql/11/main/pg_hba.conf
  sudo systemctl restart postgresql
  sudo systemctl enable postgresql
elif [ -z &quot;${OS_ID##*rhel*}&quot; ]; then
  #CentOS/RHEL/Fedora
  sudo yum install -y postgresql-server postgresql-server-devel postgresql-contrib postgresql-devel libpq-devel
  sudo postgresql-setup initdb
  sudo sed -i &quot;s#  ident#  md5#g&quot; /var/lib/pgsql/data/pg_hba.conf
  sudo systemctl start postgresql
  sudo systemctl enable postgresql
else
  echo &quot;We have no automated procedures for this ${DISTRO} system&quot;
fi
</code></pre>
<h4><a class="header" href="#create-user-in-postgres" id="create-user-in-postgres">Create User in Postgres</a></h4>
<p>Login to Postgres instance as superuser:</p>
<pre><code class="language-bash">echo $(whoami)
# &lt;user&gt;
sudo su postgres
psql
</code></pre>
<p>Note the <user> returned as the output of <code>echo $(whoami)</code> command. Replace all instance of <user> in the documentation below.
Execute the below in psql prompt. Replace <strong><username></strong> and <strong>PasswordYouWant</strong> with your OS user (output of <code>echo $(whoami)</code> command executed above) and a password you'd like to authenticate to Postgres with:</p>
<pre><code class="language-sql">CREATE ROLE &lt;user&gt; SUPERUSER LOGIN;
ALTER USER &lt;user&gt; PASSWORD 'PasswordYouWant';
\q
</code></pre>
<p>Type <code>exit</code> at shell to return to your user from postgres</p>
<h4><a class="header" href="#verify-login-to-postgres-instance" id="verify-login-to-postgres-instance">Verify Login to postgres instance</a></h4>
<pre><code class="language-bash">export PGPASSFILE=$CNODE_HOME/priv/.pgpass
echo &quot;localhost:5432:cexplorer_phtn:$(whoami):PasswordYouWant&quot; &gt; $PGPASSFILE
chmod 0600 $PGPASSFILE
psql postgres
# psql (10.6)
# Type &quot;help&quot; for help.
# 
# postgres=#
</code></pre>
<h3><a class="header" href="#contributors" id="contributors">Contributors</a></h3>
<p>Everyone is welcome to contribute to the guide, as well as the repository. Below is just a thank you to people who have been contributing consistently:</p>
<p><a href="https://github.com/rdlrt">Priyank</a><br />
<a href="https://github.com/gufmar">Markus</a><br />
<a href="https://github.com/ilap">Pal Dorogi</a><br />
<a href="https://github.com/papacarp">Papacarp</a><br />
<a href="https://github.com/PegasusPool">PegasusPool</a><br />
<a href="https://github.com/oldcryptogeek">OCG</a><br />
<a href="https://github.com/RedOracle">RedOracle</a><br />
<a href="https://github.com/mmahut">Marek</a></p>
<p>The document wouldn't be complete in absence of active testers from the community to provide invaluable inputs.</p>
<p><a href="https://github.com/psychomb">Psychomb</a><br />
<a href="https://github.com/Scitz0">Ola Ahlman</a><br />
<a href="https://github.com/bergr01">Bergr01</a><br />
<a href="https://github.com/matthijs_last">Matthijs</a></p>
<p><strong>Hopefully we have more joining the list soon :) To start contributing, simply hit the <a href="https://github.com/cardano-community/guild-operators">github repository</a> and raise Issue/Pull Request</strong></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        
        <script src="ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="editor.js" type="text/javascript" charset="utf-8"></script>
        <script src="mode-rust.js" type="text/javascript" charset="utf-8"></script>
        <script src="theme-dawn.js" type="text/javascript" charset="utf-8"></script>
        <script src="theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>
        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
