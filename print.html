<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js ayu">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Cardano Community managed Documentation for Pool Operators</title>
        
        <meta name="robots" content="noindex" />
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="Home.html">Getting Started</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Build-and-Run.html">Build and Run</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Folder-structure.html">Common</a></li><li class="chapter-item expanded "><a href="node-cli.html">Node and CLI</a></li><li class="chapter-item expanded "><a href="dbsync.html">DBSync tool</a></li><li class="chapter-item expanded "><a href="rest.html">REST - TBD</a></li><li class="chapter-item expanded "><a href="graphql.html">GraphQL</a></li></ol></li><li class="chapter-item expanded "><a href="Setup-BFT-Member.html">Set up and connect to the network as BFT leader</a></li><li class="chapter-item expanded "><a href="Setup-Passive-Member.html">Set up and connect to the network as a passive member</a></li><li class="chapter-item expanded "><a href="cli-scripts.html">Useful Scripts</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="createAddr.html">Create Keys/Address</a></li><li class="chapter-item expanded "><a href="sendADA.html">Make Transactions</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="Contributors.html">Contributors</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu (default)</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Cardano Community managed Documentation for Pool Operators</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        <a href="https://github.com/cardano-community/guild-operators" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h3><a class="header" href="#welcome" id="welcome">Welcome!!</a></h3>
<p>This documentation (rather the repository itself) is created by some of the community members and serves as as easy means to add documentation or scripts that makes more sense to users. The target audience for this document are mainly experienced stake pool operators.</p>
<p>The repository is already open to collaboration from many members within community. We would love community contributions and verification of the instructions, rather than having 100 version of documentations. If there are any discrepancies/suggestions/contributions for this document, please open a issue and one of the collaborators should be able to add the changes in.</p>
<h4><a class="header" href="#getting-started-with-haskell-node" id="getting-started-with-haskell-node">Getting started with Haskell Node</a></h4>
<p>Use the sidebar to navigate through the topics. Note that the instructions assume the folder structure as per Next topic, you're expected to update the folder reference as per your environment.
Also, since you cannot run a Praos node yet, the instructions here-in allow you to join a private haskell testnet network (phtn), we will gradually update to Praos version and update the phtn references.</p>
<p><em>Note that currently the codebase cardano-node is using permissive oBFT consensus. While we would like to onboard new features as they're built for Shelley (which will be hybrid of oBFT nodes run by bootstrap entities and Praos nodes by stakepool operators) codebase, its best to set your expectation accordingly. In the current state, this serves as a useful means to get familiar with modular architecture and usage.</em></p>
<h3><a class="header" href="#build-and-run" id="build-and-run">Build and Run</a></h3>
<p>This document is built using instructions from <a href="https://github.com/input-output-hk">IOHK repositories</a> as base with additional info/clarification, which we can propose to add if it makes sense.</p>
<p><strong>The instructions are intentionally limited to cabal</strong> to avoid wait times/availability of nix/docker/stack.yaml files on what we expect to be rapidly developing codebase - this will also help prevent managing multiple versions of instructions (atleast for now).</p>
<p>Note that the instructions are mainly focused around building Cardano components and OS/thirdparty software (eg: postgres) setup instructions are intended to provide build level information only.</p>
<p>Ofcourse, we can always add links with specific best practices to those instructions - for those who would like to contribute, please open a PR directly on the <a href="https://github.com/cardano-community/guild-operators/tree/master/docs">github repo</a> to do so.</p>
<h4><a class="header" href="#docker-builds" id="docker-builds">Docker Builds:</a></h4>
<p>If you would want to go down the docker route, the basic instructions to get you set up with docker itself are below, while the you can follow <a href="https://input-output-hk.github.io/adrestia/docs/installation/">IOHK Adrestia documentation</a> for latest release information:</p>
<pre><code class="language-bash"># CentOS
sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
sudo yum install https://download.docker.com/linux/centos/7/x86_64/stable/Packages/containerd.io-1.2.6-3.3.el7.x86_64.rpm
sudo yum install -y docker-ce docker-ce-cli
sudo systemctl enable docker
sudo chkconfig docker on

## These steps would be automatically performed by the install above
# sudo groupadd docker
# sudo usermod -aG docker $USER
sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.25.5/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/bin/docker-compose;chmod 755 /usr/bin/docker-compose
</code></pre>
<h3><a class="header" href="#folder-structure" id="folder-structure">Folder structure</a></h3>
<p>The documentations here use the below as a reference folder.</p>
<pre><code>/opt/cardano/cnode          # Top-Level Folder
├── ...
├── files                   # Config, genesis and topology files
│   ├── ...
│   ├── genesis.json        # Genesis file referenced in ptn0.yaml
│   ├── ptn0.yaml           # Config file used by cardano-node
│   └── inventory.json      # Map of Real-PBFT chain for cardano-node
├── db                      # DB Store for cardano-node
├── logs                    # Logs for cardano-node
├── priv                    # Folder to store your keys (permission: 600)
├── scripts                 # Scripts to start and interact with cardano-node
├── sockets                 # Socket files created by cardano-node
└── ...
</code></pre>
<p>You can create the above using sample commands below:</p>
<pre><code class="language-bash">export CNODE_HOME=/opt/cardano/cnode
sudo mkdir -p ${CNODE_HOME}/{files,db,logs,scripts,sockets,priv}
sudo chown -R $USER:$USER $CNODE_HOME
chmod -R 755 $CNODE_HOME

mkdir ~/git # To hold git repositories that will be used for building binaries

cd $CNODE_HOME/files

curl -o ptn0.yaml https://raw.githubusercontent.com/cardano-community/guild-operators/master/files/ptn0/files/ptn0.yaml
curl https://raw.githubusercontent.com/cardano-community/guild-operators/master/files/ptn0/files/genesis.json | jq '.' &gt; genesis.json
curl https://raw.githubusercontent.com/cardano-community/guild-operators/master/files/ptn0/files/topology.json | jq '.' &gt; topology.json

# If using a different CNODE_HOME than in this example, execute the below:
# sed -i -e &quot;s#/opt/cardano/cnode#${CNODE_HOME}#&quot; $CNODE_HOME/files/ptn0.yaml
## For future use:
## It generates random NodeID:
## -e &quot;s#NodeId:.*#NodeId:`od -A n -t u8 -N 8 /dev/urandom`#&quot; \

cd -
cd $CNODE_HOME/scripts
curl -o env https://raw.githubusercontent.com/cardano-community/guild-operators/master/scripts/cnode-helper-scripts/env
curl -o sendADA.sh https://github.com/cardano-community/guild-operators/blob/master/scripts/cnode-helper-scripts/sendADA.sh
curl -o cnode.sh https://raw.githubusercontent.com/cardano-community/guild-operators/master/files/ptn0/scripts/cnode.sh.templ
# If you opt for an alternate CNODE_HOME, please run the below:
# sed -i -e &quot;s#/opt/cardano/cnode#${CNODE_HOME}#&quot; *.sh
cd -
</code></pre>
<h3><a class="header" href="#building-cardano-node-and-cardano-cli" id="building-cardano-node-and-cardano-cli">Building Cardano Node and Cardano CLI</a></h3>
<h4><a class="header" href="#pre-requisites" id="pre-requisites">Pre-Requisites</a></h4>
<h5><a class="header" href="#system-packages" id="system-packages">System Packages</a></h5>
<p>The Haskell cardano-node build requires the following dependency packages to be available to the system:</p>
<p><strong>Tip</strong>: The steps described individually below can be executed with the two scripts &quot;<a href="https://github.com/cardano-community/guild-operators/blob/master/files/ptn0/scripts/cabal-prepare.sh">cabal_prepare</a>&quot; and &quot;<a href="https://github.com/cardano-community/guild-operators/blob/master/files/ptn0/scripts/cabal-build-all-install.sh">build-all-install</a>&quot;. (<em>prepare</em> automatically recognizes Debian/Ubuntu or CentOS)</p>
<p>The instructions for <strong>Debian and Ubuntu</strong> are identical.</p>
<pre><code class="language-bash">sudo apt-get update
sudo apt-get -y install curl build-essential pkg-config libffi-dev libgmp-dev libssl-dev libtinfo-dev libsystemd-dev zlib1g-dev tmux git
</code></pre>
<p>If you're using <strong>CentOS</strong>, the corresponding packages will be:</p>
<pre><code class="language-bash">sudo yum update
sudo yum -y install curl pkgconfig libffi-devel gmp-devel openssl-devel ncurses-libs systemd-devel zlib-devel tmux git
# You might need to create a symlink to /usr/lib64/libtinfo.so as per below if one does not already exist
# sudo ln -s $(ls -1 /usr/lib64/libtinfo.so* | tail -1) /usr/lib64/libtinfo.so
# sudo ln -s $(ls -1 /usr/lib64/libtinfo.so* | tail -1) /usr/lib64/libtinfo.so.5
</code></pre>
<h4><a class="header" href="#ghc-and-cabal" id="ghc-and-cabal">GHC and Cabal</a></h4>
<p>The node depends on very specific versions of <a href="https://www.haskell.org/ghcup/">GHC 8.6.5</a> and [Cabal 3.0].
The best way to get them is with the Haskell Installer tool [ghcup].</p>
<pre><code class="language-bash">mkdir ~/tmp;cd ~/tmp
curl --proto '=https' --tlsv1.2 -sSf https://get-ghcup.haskell.org | sh

# confirm by pressing ENTER twice and type YES at the end to add ghcup to your PATH variable.

source ~/.ghcup/env
</code></pre>
<p>Now install and activate the required GHC version</p>
<pre><code class="language-bash">ghcup install 8.6.5
ghcup set 8.6.5
ghc --version
</code></pre>
<p>To download and install cabal specific release, follow instructions below:</p>
<pre><code class="language-bash">wget https://downloads.haskell.org/cabal/cabal-install-3.0.0.0/cabal-install-3.0.0.0-x86_64-unknown-linux.tar.xz
tar xf cabal-install-3.0.0.0-x86_64-unknown-linux.tar.xz
cp cabal ~/.ghcup/bin
cd -
</code></pre>
<h4><a class="header" href="#build-instructions" id="build-instructions">Build Instructions</a></h4>
<p>Now that the dependencies have been met, we can start setting up the node.
Start by cloning the Cardano Node git to build the binaries:</p>
<pre><code class="language-bash">cd ~/git
git clone https://github.com/input-output-hk/cardano-node
cd cardano-node
cabal build all | tee build.log | grep ^Linking
</code></pre>
<p>Now you can copy the binaries build (using location above) into ~/.local/bin folder (when part of the PATH variable).</p>
<pre><code>cardano-node
cardano-cli
chairman
</code></pre>
<p>For example for cardano-cli 1.10.1 it is <code>~/git/cardano-node/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-node-1.10.1/x/cardano-cli/build/cardano-cli/cardano-cli</code></p>
<h4><a class="header" href="#verify" id="verify">Verify</a></h4>
<p>Execute cardano-cli and cardano-node to verify output as below:</p>
<pre><code class="language-bash">cardano-cli version
# cardano-cli 1.10.1 - linux-x86_64 - ghc-8.6
cardano-node
#Usage: cardano-node (run | run-mock) [--help]
#  Start node of the Cardano blockchain.
#
#Available options:
#  --help                   Show this help text
#
#Execute node with a real protocol.
#  run                      Execute node with a real protocol.
#
#Execute node with a mock protocol.
#  run-mock                 Execute node with a mock protocol.
</code></pre>
<h3><a class="header" href="#dbsync-tool" id="dbsync-tool">DBSync tool</a></h3>
<p>Cardano DB Sync tool relies on an existing PostgreSQL server.</p>
<h4><a class="header" href="#sample-local-postgresql-server-deployment-instructions" id="sample-local-postgresql-server-deployment-instructions">Sample Local PostgreSQL Server Deployment instructions</a></h4>
<p>These are sample PostgreSQL server deployment instructions used for reference while building Cardano DB Sync tool. These do not go into Best practices for deploying a secured instance, we would recommend you to customise the same as per your needs.</p>
<pre><code class="language-bash"># TODO: Add debian/Ubuntu specific commands
sudo yum install -y postgresql-server postgresql-server-devel postgresql-contrib postgresql-devel
sudo postgresql-setup initdb
# TODO: For consistency on this page, edit /var/lib/pgsql/data/pg_hba.conf to replace ident with md5 for localhost and 127.0.0.1 (except lines with replication)
sudo systemctl start postgresql
sudo systemctl enable postgresql
</code></pre>
<p>This page assumes you've already set up cardano-noe and have the OS level dependencies satisfied.</p>
<h4><a class="header" href="#build-cardano-db-sync" id="build-cardano-db-sync">Build cardano-db-sync</a></h4>
<p>To build instructions for cardano-db-sync tool will be similar to cardano-node:</p>
<pre><code class="language-bash">cd ~/git
git clone https://github.com/input-output-hk/cardano-db-sync
cd cardano-db-sync
cabal build all | tee build.log | grep ^Linking
</code></pre>
<p>Similar to before, you can copy the cardano-db-sync and cardano-db-sync-extended binary to your ~/.local/bin folder.</p>
<h4><a class="header" href="#create-user-in-postgres" id="create-user-in-postgres">Create User in Postgres</a></h4>
<p>Login to Postgres instance as superuser:</p>
<pre><code class="language-bash">echo $(whoami)
sudo su postgres
psql
</code></pre>
<p>Execute the below in psql prompt. Replace <strong><username></strong> and <strong>PasswordYouWant</strong> with your OS user (output of <code>echo $(whoami)</code> command executed above) and a password you'd like to authenticate to Postgres with:</p>
<pre><code class="language-sql">CREATE ROLE &lt;username&gt; superuser;
CREATE USER &lt;username&gt;;
GRANT ROOT TO &lt;username&gt;;
ALTER USER &lt;username&gt; PASSWORD 'PasswordYouWant';
\q
</code></pre>
<p>Type <code>exit</code> to return to your original user</p>
<h4><a class="header" href="#verify-login-to-postgres-instance" id="verify-login-to-postgres-instance">Verify Login to postgres instance</a></h4>
<pre><code class="language-bash">export PGPASSFILE=/opt/cardano/cnode/priv/.pgpass
echo &quot;localhost:5432:cexplorer_phtn:$(whoami):PasswordYouWant&quot; &gt; $PGPASSFILE
chmod 0600 /opt/cardano/cnode/priv/.pgpass
psql -U $(whoami)
## TODO: Sample output
</code></pre>
<h4><a class="header" href="#prepare-db-for-cardano-db-sync-" id="prepare-db-for-cardano-db-sync-">Prepare DB for cardano-db-sync :</a></h4>
<pre><code class="language-bash">cd ~/git/cardano-db-sync
# scripts/postgresql-setup.sh --dropdb #if exists already, will fail if it doesnt - thats OK
scripts/postgresql-setup.sh --createdb
# Password:
# Password:
# All good!
## Verify you can see &quot;All good!&quot; as above
</code></pre>
<h4><a class="header" href="#start-cardano-db-sync-tool" id="start-cardano-db-sync-tool">Start cardano-db-sync-tool</a></h4>
<pre><code class="language-bash">cd ~/git/cardano-db-sync
PGPASSFILE=/opt/cardano/cnode/priv/.pgpass cardano-db-sync --config /opt/cardano/cnode/files/ptn0.yaml --genesis-file /opt/cardano/cnode/files/genesis.json --socket-path /opt/cardano/cnode/sockets/pbft_node.socket --schema-dir schema/
</code></pre>
<p>You can use same instructions above to repeat and execute <code>cardano-db-sync</code> as well, but <a href="./graphql.html">cardano-graphql</a> uses <code>cardano-db-sync-extended</code>, so we'll stick to it</p>
<h4><a class="header" href="#validation" id="validation">Validation</a></h4>
<p>To validate, connect to postgres instance and execute commands as per below:</p>
<pre><code class="language-bash">export PGPASSFILE=/opt/cardano/cnode/priv/.pgpass
psql cexplorer_phtn
</code></pre>
<p>You should be at the psql prompt, you can check the tables and verify they're populated:</p>
<pre><code class="language-sql">\dt
#            List of relations
# Schema |      Name      | Type  | Owner
#--------+----------------+-------+-------
# public | block          | table | &lt;username&gt;
# public | epoch          | table | &lt;username&gt;
# public | meta           | table | &lt;username&gt;
# public | schema_version | table | &lt;username&gt;
# public | slot_leader    | table | &lt;username&gt;
# public | tx             | table | &lt;username&gt;
# public | tx_in          | table | &lt;username&gt;
# public | tx_out         | table | &lt;username&gt;
#(8 rows)

select * from meta;
# id | protocol_const | slot_duration |     start_time      | network_name
#----+----------------+---------------+---------------------+--------------
#  1 |          43200 |         20000 | 2020-04-12 13:55:37 | pHTN
#(1 row)

select * from tx;
# id |                                hash                                | block | fee |     out_sum      | size
#----+--------------------------------------------------------------------+-------+-----+------------------+------
#  1 | \x26b63ce785b16fc53ba3ab882ac0e5342a77b33f355ba82982e3e2d5e05500df |     1 |   0 |       1000000000 |    0
#  2 | \xbd8f661658dabbb557d4b5e23264d34fda2a2304daccdac283e337581a88c479 |     1 |   0 |   62499975000000 |    0
#  3 | \x17fbf571b7d091e9cfb6853cd5fb603031831ce7e5e3acbb4b842960e90ba419 |     1 |   0 |   62499975000000 |    0
#  4 | \x3e7e3c1105d3bd76a2b5ae897e1b79b86c7834e68409e533afc318112405ff69 |     1 |   0 |   62499975000000 |    0
# ...
# (36 rows)
</code></pre>
<h3><a class="header" href="#rest" id="rest">REST</a></h3>
<p>&lt; Coming Soon .. &gt;</p>
<h3><a class="header" href="#graphql" id="graphql">GraphQL</a></h3>
<h4><a class="header" href="#pre-requisites-1" id="pre-requisites-1">Pre-Requisites</a></h4>
<p>Execute the below to set up yarn and dependencies</p>
<pre><code class="language-bash">curl --silent --location https://dl.yarnpkg.com/rpm/yarn.repo | sudo tee /etc/yum.repos.d/yarn.repo
sudo rpm --import https://dl.yarnpkg.com/rpm/pubkey.gpg
sudo yum -y install yarn npm python3 make gcc-c++
</code></pre>
<p>Going with the spirit of the documentation here, instruction to build the graphql-engine binary :)</p>
<pre><code class="language-bash">cd ~/git
git clone https://github.com/hasura/graphql-engine
cd graphql-engine/server
cabal build all
cp dist-newstyle/build/x86_64-linux/ghc-8.6.5/graphql-engine-1.0.0/x/graphql-engine/opt/build/graphql-engine/graphql-engine ~/.local/bin
</code></pre>
<h4><a class="header" href="#build-cardano-graphql" id="build-cardano-graphql">Build cardano-graphql</a></h4>
<p>The command below will help you compile the cardano-graphql node:</p>
<pre><code class="language-bash">git clone https://github.com/input-output-hk/cardano-graphql
cd cardano-graphql
yarn
#yarn install v1.22.4
# [1/4] Resolving packages...
# [2/4] Fetching packages...
# info fsevents@2.1.2: The platform &quot;linux&quot; is incompatible with this module.
# info &quot;fsevents@2.1.2&quot; is an optional dependency and failed compatibility check. Excluding it from installation.
# info fsevents@1.2.12: The platform &quot;linux&quot; is incompatible with this module.
# info &quot;fsevents@1.2.12&quot; is an optional dependency and failed compatibility check. Excluding it from installation.
# [3/4] Linking dependencies...
# warning &quot; &gt; graphql-type-datetime@0.2.4&quot; has incorrect peer dependency &quot;graphql@^0.13.2&quot;.
# warning &quot; &gt; @typescript-eslint/eslint-plugin@1.13.0&quot; has incorrect peer dependency &quot;eslint@^5.0.0&quot;.
# warning &quot; &gt; @typescript-eslint/parser@1.13.0&quot; has incorrect peer dependency &quot;eslint@^5.0.0&quot;.
# [4/4] Building fresh packages...
# Done in 20.70s.
yarn build
# yarn run v1.22.4
# $ yarn codegen:internal &amp;&amp; yarn codegen:external &amp;&amp; tsc -p . &amp;&amp; shx cp src/schema.graphql dist/
# $ graphql-codegen
#   ✔ Parse configuration
#   ✔ Generate outputs
# $ graphql-codegen --config ./codegen.external.yml
#   ✔ Parse configuration
#   ✔ Generate outputs
# Done in 38.11s.
cd dist
rsync -arvh ../node_modules ./
</code></pre>
<h4><a class="header" href="#set-up-environment-for-cardano-graphql" id="set-up-environment-for-cardano-graphql">Set up environment for cardano-graphql</a></h4>
<p>cardano-graphql requires cardano-node, cardano-db-sync-extended, postgresql and graphql-engine to be set up and running.
The below will help you map the components:</p>
<pre><code class="language-bash"># TODO: Improve and script the below
export CNODE_HOME=/opt/cardano/cnode
export PGPASSFILE=$CNODE_HOME/priv/.pgpass
PGPASS=$(cat $PGPASSFILE)
PG_HOST=$(echo $PGPASS | cut -d: -f 1)
PG_PORT=$(echo $PGPASS | cut -d: -f 2)
PG_DB=$(echo $PGPASS | cut -d: -f 3)
PG_USER=$(echo $PGPASS | cut -d: -f 4)
PG_PWD=$(echo $PGPASS | cut -d: -f 5)
export NETWORK=phtn
export EXTENDED=true
export HASURA_GRAPHQL_DATABASE_URL=postgres://$PG_USER:$PG_PWD@$PG_HOST:$PG_PORT/$PG_DB
export HASURA_GRAPHQL_ENABLE_CONSOLE=true
export HASURA_GRAPHQL_ENABLED_LOG_TYPES=&quot;startup, http-log, webhook-log, websocket-log, query-log&quot;
export HASURA_GRAPHQL_SERVER_PORT=4080
export HASURA_GRAPHQL_SERVER_HOST=0.0.0.0
export CACHE_ENABLED=true
export HASURA_URI=http://127.0.0.1:4080/v1/graphql
cd -;cd ~/git/cardano-graphql/dist
graphql-engine serve
node index.js
</code></pre>
<h3><a class="header" href="#config-for-phtn---as-a-bft-member" id="config-for-phtn---as-a-bft-member">Config for pHTN - as a BFT Member</a></h3>
<p>Use this guide only if you already have your key (referred to as pbft0.key below) that's already registered in genesis.</p>
<h4><a class="header" href="#create-verification-key" id="create-verification-key">Create verification key</a></h4>
<pre><code class="language-bash"># Create the verification key
cardano-cli to-verification --real-pbft --secret $CNODE_HOME/priv/pbft0.key --to $CNODE_HOME/priv/pbft0.vfk

# Check the verification/public key
cardano-cli signing-key-public --real-pbft --secret $CNODE_HOME/priv/pbft0.key | awk '/base64/ { print $4}'
# HyZ+SQ3odbYPH...A==
cat $CNODE_HOME/priv/pbft0.vfk
# HyZ+SQ3odbYPH...A==
</code></pre>
<h4><a class="header" href="#extract-your-cert-from-genesis-using-below" id="extract-your-cert-from-genesis-using-below">Extract your cert from genesis using below</a></h4>
<pre><code class="language-bash"># Extract cert from genesis.
grep `cat $CNODE_HOME/priv/pbft0.vfk` -B 4 -A 3 $CNODE_HOME/files/genesis.json | sed -e 's@^.*{@{@' -e 's@^.*},@}@' &gt; $CNODE_HOME/priv/pbft0.json
</code></pre>
<h4><a class="header" href="#start-node" id="start-node">Start Node</a></h4>
<pre><code class="language-bash"># Run the node
cd $CNODE_HOME/scripts
./cnode.sh
</code></pre>
<h3><a class="header" href="#config-for-phtn---as-a-passive-node" id="config-for-phtn---as-a-passive-node">Config for pHTN - as a Passive node</a></h3>
<h4><a class="header" href="#create-singing-and-verifying-keys" id="create-singing-and-verifying-keys">Create singing and verifying keys</a></h4>
<pre><code class="language-bash">$ cardano-cli keygen --real-pbft --secret $CNODE_HOME/priv/pbft0p.key --no-password
</code></pre>
<h4><a class="header" href="#create-verification-key-1" id="create-verification-key-1">Create verification key</a></h4>
<pre><code class="language-bash"># Create the verification key
cardano-cli to-verification --real-pbft --secret $CNODE_HOME/priv/pbft0p.key --to $CNODE_HOME/priv/pbft0p.vfk

# Check the verification/public key
cardano-cli signing-key-public --real-pbft --secret $CNODE_HOME/priv/pbft0p.key | awk '/base64/ { print $4}'
# HyZ+SQ3odbYPH...A==
cat $CNODE_HOME/priv/pbft0p.vfk
# HyZ+SQ3odbYPH...A==
</code></pre>
<h4><a class="header" href="#create-certificates" id="create-certificates">Create certificates</a></h4>
<pre><code class="language-bash">$ cardano-cli issue-delegation-certificate \
--config $CNODE_HOME/files/config.json \
--since-epoch &lt;?&gt; \
--secret &lt;THE ISSUER SECRET/KEY FOR GENESIS&gt; \
--delegate-key $CNODE_HOME/priv/pbft0p.key \
--certificate $CNODE_HOME/files/pbft0p.json
</code></pre>
<h4><a class="header" href="#start-passive-node" id="start-passive-node">Start Passive Node</a></h4>
<pre><code class="language-bash">CNODE_HOME=/opt/cardano/cnode
cardano-node run \
          --config $CNODE_HOME/files/ptn0.yaml \
          --database-path $CNODE_HOME/db \
          --host-addr $(curl ifconfig.me) \
          --signing-key $CNODE_HOME/priv/pbft0p.key \
          --delegation-certificate $CNODE_HOME/files/pbft0p.json \
          --port 9000 \
          --socket-path $CNODE_HOME/sockets/0 \
          --topology $CNODE_HOME/files/topology.json
</code></pre>
<h3><a class="header" href="#collection-of-value-added-scripts" id="collection-of-value-added-scripts">Collection of Value-added scripts</a></h3>
<p>A place to collect scripts that are supposed to help with usage of Cardano-node. The initial attempt below is with an aim to keep things similar to the current jormungandr scripts' usage.</p>
<h4><a class="header" href="#create-privat-key-and-corresponding-address-file" id="create-privat-key-and-corresponding-address-file">Create Privat key and corresponding address file</a></h4>
<pre><code class="language-bash">cd $CNODE_HOME/scripts
./createAddr.sh pbft1
# Sample output to enter passphrase (can be left empty, you will need this passphrase to access the key if filled):
# Enter password to encrypt 'pbft1':
# Repeat to validate:
</code></pre>
<h4><a class="header" href="#create-and-submit-a-transaction-to-send-ada" id="create-and-submit-a-transaction-to-send-ada">Create and submit a transaction to send ADA</a></h4>
<pre><code># Send ADA script usage
cd $CNODE_HOME/scripts
./sendADA.sh tx.out 2cWKMJemoBa....ssL7fzhq 20 $CNODE_HOME/priv/pbft0.key
</code></pre>
<h3><a class="header" href="#create-keysaddress" id="create-keysaddress">Create Keys/Address</a></h3>
<p>&lt; Coming Soon .. &gt;</p>
<h3><a class="header" href="#make-transactions" id="make-transactions">Make Transactions</a></h3>
<p>&lt; Coming Soon .. &gt;</p>
<h3><a class="header" href="#contributors" id="contributors">Contributors</a></h3>
<p>Everyone is welcome to contribute to the guide, as well as repository. Below is just a thank you to people who have been contributing consistently:</p>
<p><a href="https://github.com/gufmar">Markus</a><br />
<a href="https://github.com/ilap">Pal Dorogi</a><br />
<a href="https://github.com/papacarp">Papacarp</a><br />
<a href="https://github.com/PegasusPool">PegasusPool</a><br />
<a href="https://github.com/oldcryptogeek">OCG</a><br />
<a href="https://github.com/RedOracle">RedOracle</a><br />
<a href="https://github.com/mmahut">Marek</a></p>
<p>The document wouldnt be complete in absence of active testers from the community to provide invaluable inputs,</p>
<p><a href="https://github.com/psychomb">Psychomb</a><br />
<a href="https://github.com/bergr01">Bergr01</a><br />
<a href="https://github.com/matthijs_last">Matthijs</a></p>
<p><strong>Hopefully we have more joining the list soon :) To start contributing, simply hit the <a href="https://github.com/cardano-community/guild-operators">github repository</a> and raise Issue/Pull Request</strong></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>
        
        

    </body>
</html>
